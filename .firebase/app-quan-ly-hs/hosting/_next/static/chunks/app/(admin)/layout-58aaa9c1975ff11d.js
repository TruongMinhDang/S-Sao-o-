(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4480],{23397:function(e,t,n){Promise.resolve().then(n.bind(n,99719))},99719:function(e,t,n){"use strict";n.d(t,{default:function(){return o}});var r=n(27573),i=n(7653),u=n(81695),a=n(76553);function o(e){let{children:t}=e,{user:n,loading:o,isSuperAdmin:s}=(0,a.a)(),l=(0,u.useRouter)();return((0,i.useEffect)(()=>{if(!o){if(!n){l.replace("/auth/action");return}s||l.replace("/")}},[n,o,s,l]),o||!s)?(0,r.jsx)("div",{className:"flex h-screen items-center justify-center",children:(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Đang kiểm tra quyền truy cập..."})}):n&&s?(0,r.jsx)(r.Fragment,{children:t}):null}},76553:function(e,t,n){"use strict";n.d(t,{H:function(){return f},a:function(){return p}});var r=n(27573),i=n(7653),u=n(78022),a=n(66356),o=n(81695);let s=(0,i.createContext)(void 0),l=["/login","/auth/action"],c={admin:"/tong-quan",viewerAdmin:"/tong-quan",teacher:"/lop-cua-toi",default:"/tong-quan"},_=e=>"admin"===e,E=e=>["hieu_truong","pho_hieu_truong","nv_tin_hoc"].includes(e||""),d=e=>["giao_vien_chu_nhiem","homeroom_teacher"].includes(e||""),h=e=>"giam_thi"===e;function I(){let e=(0,u.v0)(a.l),[t,n]=(0,i.useState)(""),o=async()=>{if(e.currentUser)try{await (0,u.w$)(e.currentUser),n("Đ\xe3 gửi lại email x\xe1c thực. Vui l\xf2ng kiểm tra hộp thư của bạn.")}catch(e){console.error(e),n("Lỗi: ".concat(e.message))}},s=async()=>{try{await e.signOut()}catch(e){console.error("Error signing out:",e)}};return(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100vh",textAlign:"center",padding:"20px",backgroundColor:"#f0f2f5"},children:[(0,r.jsx)("h1",{style:{fontSize:"24px",marginBottom:"20px"},children:"Y\xeau cầu X\xe1c thực Email"}),(0,r.jsx)("p",{style:{marginBottom:"20px"},children:"T\xe0i khoản của bạn chưa được x\xe1c thực. Vui l\xf2ng kiểm tra hộp thư v\xe0 nhấn v\xe0o li\xean kết x\xe1c thực để tiếp tục."}),(0,r.jsxs)("div",{style:{display:"flex",gap:"10px"},children:[(0,r.jsx)("button",{onClick:o,style:{padding:"10px 20px",backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"5px",cursor:"pointer"},children:"Gửi lại Email"}),(0,r.jsx)("button",{onClick:s,style:{padding:"10px 20px",backgroundColor:"#6c757d",color:"white",border:"none",borderRadius:"5px",cursor:"pointer"},children:"Đăng xuất"})]}),t&&(0,r.jsx)("p",{style:{marginTop:"20px",color:"green"},children:t})]})}function f(e){let{children:t}=e,[n,f]=(0,i.useState)(null),[p,m]=(0,i.useState)(null),[A,g]=(0,i.useState)(!0),[C,P]=(0,i.useState)(!1),B=(0,o.useRouter)(),T=(0,o.usePathname)();(0,i.useEffect)(()=>{let e=(0,u.v0)(a.l),t=(0,u.Aj)(e,async t=>{if(t)try{await t.reload();let i=e.currentUser;if(i&&(f(i),P(i.emailVerified),i.emailVerified)){var n,r;let e=(await i.getIdTokenResult()).claims,t=e.assignedClasses,u=[];Array.isArray(t)?u=t:"string"==typeof t&&t.length>0&&(u=t.split(",").map(e=>e.trim()));let a={displayName:null!==(n=i.displayName)&&void 0!==n?n:void 0,email:null!==(r=i.email)&&void 0!==r?r:void 0,role:e.role,assignedClasses:u};m(a),a.role||console.warn("User logged in but has no 'role' claim. UID: ".concat(i.uid))}}catch(e){console.error("Error processing auth state:",e),m(null),f(null)}else m(null),f(null),P(!1);g(!1)});return()=>t()},[]);let S=null==p?void 0:p.role,x=_(S),R=E(S),N=d(S),v=h(S),U=x||R;return((0,i.useEffect)(()=>{if(A)return;let e=l.includes(T);n&&C?(e||"/"===T)&&(x?B.push(c.admin):R?B.push(c.viewerAdmin):N?B.push(c.teacher):B.push(c.default)):n||e||B.push("/login")},[n,C,A,T,B,x,R,N]),A)?(0,r.jsx)("div",{children:"Đang tải..."}):n&&!C?l.includes(T)?(0,r.jsx)(r.Fragment,{children:t}):(0,r.jsx)(I,{}):(0,r.jsx)(s.Provider,{value:{user:n,userProfile:p,isAdmin:U,isSuperAdmin:x,isViewerAdmin:R,isHomeroomTeacher:N,isProctor:v,loading:A},children:t})}function p(){let e=(0,i.useContext)(s);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},66356:function(e,t,n){"use strict";n.d(t,{l:function(){return _},I:function(){return d},db:function(){return E}});var r=n(90791),i=n(21897),u=n(78022),a=n(17865),o=n(68571);function s(e){let t=o.env[e];if(!t||""===t.trim())throw Error("Thiếu biến m\xf4i trường ".concat(e,". Kiểm tra .env.local / secrets."));return t}let l={NEXT_PUBLIC_FIREBASE_API_KEY:s("NEXT_PUBLIC_FIREBASE_API_KEY"),NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN:s("NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN"),NEXT_PUBLIC_FIREBASE_PROJECT_ID:s("NEXT_PUBLIC_FIREBASE_PROJECT_ID"),NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET:s("NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET"),NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID:s("NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID"),NEXT_PUBLIC_FIREBASE_APP_ID:s("NEXT_PUBLIC_FIREBASE_APP_ID"),NEXT_PUBLIC_RECAPTCHA_SITE_KEY:s("NEXT_PUBLIC_RECAPTCHA_SITE_KEY")},c={apiKey:l.NEXT_PUBLIC_FIREBASE_API_KEY,authDomain:l.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,projectId:l.NEXT_PUBLIC_FIREBASE_PROJECT_ID,storageBucket:l.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,messagingSenderId:l.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,appId:l.NEXT_PUBLIC_FIREBASE_APP_ID},_=(0,r.C6)().length?(0,r.Mq)():(0,r.ZF)(c);{let e=globalThis;e.__firebaseAppCheckInitialized||(e.__firebaseAppCheckInitialized=!0,(0,a.yu)(_,{provider:new a.o4(l.NEXT_PUBLIC_RECAPTCHA_SITE_KEY),isTokenAutoRefreshEnabled:!0}))}let E=(0,i.ad)(_),d=(0,u.v0)(_)},81695:function(e,t,n){"use strict";var r=n(21219);n.o(r,"usePathname")&&n.d(t,{usePathname:function(){return r.usePathname}}),n.o(r,"useRouter")&&n.d(t,{useRouter:function(){return r.useRouter}}),n.o(r,"useSearchParams")&&n.d(t,{useSearchParams:function(){return r.useSearchParams}})}},function(e){e.O(0,[6415,5117,2997,1293,1528,1744],function(){return e(e.s=23397)}),_N_E=e.O()}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9495],{75702:function(e,t,n){Promise.resolve().then(n.bind(n,86491))},86491:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return f}});var r=n(27573),a=n(7653),s=n(21897),o=n(16851),l=n(50188),c=n(50466),i=n(38976);let d=new Date(new Date().getFullYear(),8,8),u=e=>{let t=new Date(e);return t.setHours(0,0,0,0),t},h=[{name:"Khối 6",classes:["6/1","6/2","6/3","6/4","6/5","6/6","6/7","6/8","6/9","6/10"]},{name:"Khối 7",classes:["7/1","7/2","7/3","7/4","7/5","7/6","7/7","7/8"]},{name:"Khối 8",classes:["8/1","8/2","8/3","8/4","8/5","8/6","8/7"]},{name:"Khối 9",classes:["9/1","9/2","9/3","9/4","9/5","9/6","9/7","9/8"]}];h.flatMap(e=>e.classes);let m=(()=>{let e=[];for(let t=1;t<=35;t++){let n=new Date(u(d).getTime()+(t-1)*6048e5),r=new Date(n.getTime()+5184e5),a=e=>e<10?"0".concat(e):"".concat(e);e.push({weekNumber:t,label:"Tuần ".concat(t),dateRange:"(".concat(a(n.getDate()),"/").concat(a(n.getMonth()+1)," - ").concat(a(r.getDate()),"/").concat(a(r.getMonth()+1),")")})}return e})();function f(){let{toast:e}=(0,i.pm)(),[t,n]=(0,a.useState)([]),[d,u]=(0,a.useState)(!0),[f,p]=(0,a.useState)(!1),[g,b]=(0,a.useState)(null),[x,v]=(0,a.useState)("Khối 6");(0,a.useEffect)(()=>{u(!0);let e=(0,s.IO)((0,s.hJ)(o.db,"weekly_reports")),t=(0,s.cf)(e,e=>{n(e.docs.map(e=>({id:e.id,...e.data()}))),u(!1)},e=>{console.error(e),b("Lỗi khi tải dữ liệu b\xe1o c\xe1o. Collection `weekly_reports` c\xf3 thể chưa tồn tại."),u(!1)});return()=>t()},[]);let y=async()=>{if(confirm("Bạn c\xf3 chắc muốn chạy quy tr\xecnh tổng hợp b\xe1o c\xe1o kh\xf4ng? Việc n\xe0y sẽ đọc to\xe0n bộ dữ liệu điểm v\xe0 ghi đ\xe8 b\xe1o c\xe1o cũ.")){p(!0),e({title:"Bắt đầu tổng hợp...",description:"Qu\xe1 tr\xecnh c\xf3 thể mất một v\xe0i ph\xfat. Vui l\xf2ng kh\xf4ng rời khỏi trang."});try{let a=(0,s.PL)((0,s.hJ)(o.db,"records")),l=(0,s.PL)((0,s.hJ)(o.db,"weeklyScores")),[c,i]=await Promise.all([a,l]),d=c.docs.map(e=>e.data()),u=i.docs.map(e=>e.data()),m={};for(let e=1;e<=35;e++)for(let a of(m[e]={},h)){let s="Khối 9"===a.name?330:340;for(let o of a.classes){var t,n,r;let a="class_".concat(o.replace("/","_")),l=u.find(t=>t.week===e&&t.classId===a),c=(null==l?void 0:l.scores)||{},i=d.filter(t=>t.week===e&&t.className===o),h=0,f=0;i.forEach(e=>{let t=Number(e.pointsApplied||0);"merit"===e.type?h+=t:"demerit"===e.type&&(f+=Math.abs(t))});let p=null!==(t=c.hoc_tap)&&void 0!==t?t:s,g=null!==(n=c.ky_luat)&&void 0!==n?n:s,b=null!==(r=c.ve_sinh)&&void 0!==r?r:s,x=p+g+b+h-f;m[e][o]=x}}let f=(0,s.qs)(o.db);for(let e in m){let t=(0,s.JU)(o.db,"weekly_reports","week_".concat(e));f.set(t,{weekNumber:Number(e),scores:m[e]})}await f.commit(),e({title:"Th\xe0nh c\xf4ng!",description:"Đ\xe3 tổng hợp v\xe0 lưu b\xe1o c\xe1o cho ".concat(35," tuần. Dữ liệu sẽ tự động hiển thị.")})}catch(t){console.error("Lỗi khi tổng hợp b\xe1o c\xe1o:",t),e({variant:"destructive",title:"Đ\xe3 xảy ra lỗi!",description:"Kh\xf4ng thể ho\xe0n tất qu\xe1 tr\xecnh tổng hợp. Vui l\xf2ng kiểm tra console."})}finally{p(!1)}}},w=(0,a.useMemo)(()=>{var e;return(null===(e=h.find(e=>e.name===x))||void 0===e?void 0:e.classes)||[]},[x]),N=(0,a.useMemo)(()=>{let e=new Map;return t.forEach(t=>{e.set(t.weekNumber,t.scores)}),e},[t]);return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"B\xe1o c\xe1o Tổng điểm Thi đua theo Tuần"}),(0,r.jsx)("p",{className:"text-muted-foreground mt-1",children:"Bảng tổng hợp điểm thi đua h\xe0ng tuần của tất cả c\xe1c lớp trong năm học."})]}),(0,r.jsx)(c.z,{onClick:y,disabled:f,children:f?"Đang xử l\xfd...":"Tổng hợp & Cập nhật B\xe1o c\xe1o"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-4 bg-card p-4 rounded-lg border",children:[(0,r.jsx)("label",{htmlFor:"grade-select",className:"font-medium",children:"Chọn khối để hiển thị:"}),(0,r.jsx)("select",{id:"grade-select",value:x,onChange:e=>v(e.target.value),className:"border rounded px-3 py-2 bg-background shadow-sm",children:h.map(e=>(0,r.jsx)("option",{value:e.name,children:e.name},e.name))})]}),(0,r.jsx)("div",{className:"rounded-lg border overflow-hidden bg-card",children:(0,r.jsx)("div",{className:"overflow-x-auto relative max-h-[70vh]",children:(0,r.jsxs)(l.iA,{className:"min-w-full border-collapse",children:[(0,r.jsx)(l.xD,{className:"bg-muted/50 sticky top-0 z-10",children:(0,r.jsxs)(l.SC,{children:[(0,r.jsx)(l.ss,{className:"font-bold w-[200px] sticky left-0 bg-muted z-20 shadow-sm",children:"Tuần"}),w.map(e=>(0,r.jsx)(l.ss,{className:"font-bold text-center min-w-[80px]",children:e},e))]})}),(0,r.jsx)(l.RM,{children:d&&!t.length?(0,r.jsx)(l.SC,{children:(0,r.jsx)(l.pj,{colSpan:w.length+1,className:"h-48 text-center",children:"Đang tải dữ liệu..."})}):g&&!t.length?(0,r.jsx)(l.SC,{children:(0,r.jsx)(l.pj,{colSpan:w.length+1,className:"h-48 text-center text-red-600",children:g})}):m.map(e=>{let{weekNumber:t,label:n,dateRange:a}=e;return(0,r.jsxs)(l.SC,{className:"hover:bg-muted/30 group",children:[(0,r.jsxs)(l.pj,{className:"font-medium sticky left-0 bg-card group-hover:bg-muted/40 z-10 shadow-sm",children:[(0,r.jsx)("div",{className:"font-bold",children:n}),(0,r.jsx)("div",{className:"text-xs text-muted-foreground",children:a})]}),w.map(e=>{var n;let a=null===(n=N.get(t))||void 0===n?void 0:n[e];return(0,r.jsx)(l.pj,{className:"text-center font-semibold",children:"number"==typeof a?a:(0,r.jsx)("span",{className:"text-muted-foreground",children:"-"})},e)})]},t)})})]})})}),(0,r.jsx)("div",{className:"p-px rounded-lg bg-gradient-to-r from-purple-400 via-pink-500 to-blue-500",children:(0,r.jsxs)("div",{className:"bg-white dark:bg-zinc-900 p-4 rounded-[7px]",children:[(0,r.jsx)("h4",{className:"font-bold",children:"Hướng dẫn"}),(0,r.jsxs)("p",{className:"text-sm mt-1",children:["Nhấn n\xfat ",(0,r.jsx)("strong",{children:'"Tổng hợp & Cập nhật B\xe1o c\xe1o"'})," để t\xednh to\xe1n v\xe0 lưu dữ liệu điểm tổng kết h\xe0ng tuần. Bảng sẽ tự động cập nhật sau khi qu\xe1 tr\xecnh ho\xe0n tất. Bạn n\xean chạy lại quy tr\xecnh n\xe0y khi c\xf3 sự thay đổi lớn về dữ liệu điểm."]})]})})]})}},50466:function(e,t,n){"use strict";n.d(t,{z:function(){return i}});var r=n(27573),a=n(7653),s=n(8828),o=n(49289),l=n(29147);let c=(0,o.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 active:bg-blue-700",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),i=a.forwardRef((e,t)=>{let{className:n,variant:a,size:o,asChild:i=!1,...d}=e,u=i?s.g7:"button";return(0,r.jsx)(u,{className:(0,l.cn)(c({variant:a,size:o,className:n})),ref:t,...d})});i.displayName="Button"},50188:function(e,t,n){"use strict";n.d(t,{RM:function(){return c},SC:function(){return i},iA:function(){return o},pj:function(){return u},ss:function(){return d},xD:function(){return l}});var r=n(27573),a=n(7653),s=n(29147);let o=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{className:"relative w-full overflow-auto",children:(0,r.jsx)("table",{ref:t,className:(0,s.cn)("w-full caption-bottom text-sm",n),...a})})});o.displayName="Table";let l=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("thead",{ref:t,className:(0,s.cn)("[&_tr]:border-b",n),...a})});l.displayName="TableHeader";let c=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("tbody",{ref:t,className:(0,s.cn)("[&_tr:last-child]:border-0",n),...a})});c.displayName="TableBody",a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("tfoot",{ref:t,className:(0,s.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",n),...a})}).displayName="TableFooter";let i=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("tr",{ref:t,className:(0,s.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",n),...a})});i.displayName="TableRow";let d=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("th",{ref:t,className:(0,s.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",n),...a})});d.displayName="TableHead";let u=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("td",{ref:t,className:(0,s.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",n),...a})});u.displayName="TableCell",a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("caption",{ref:t,className:(0,s.cn)("mt-4 text-sm text-muted-foreground",n),...a})}).displayName="TableCaption"},38976:function(e,t,n){"use strict";n.d(t,{pm:function(){return h}});var r=n(7653);let a=0,s=new Map,o=e=>{if(s.has(e))return;let t=setTimeout(()=>{s.delete(e),d({type:"REMOVE_TOAST",toastId:e})},1e6);s.set(e,t)},l=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,10)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:n}=t;return n?o(n):e.toasts.forEach(e=>{o(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===n||void 0===n?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},c=[],i={toasts:[]};function d(e){i=l(i,e),c.forEach(e=>{e(i)})}function u(e){let t=(a=(a+1)%100).toString(),n=()=>d({type:"DISMISS_TOAST",toastId:t});return d({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:e=>{e||n()}}}),{id:t,dismiss:n,update:e=>d({type:"UPDATE_TOAST",toast:{...e,id:t}})}}function h(){let[e,t]=r.useState(i);return r.useEffect(()=>(c.push(t),()=>{let e=c.indexOf(t);e>-1&&c.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>d({type:"DISMISS_TOAST",toastId:e})}}},16851:function(e,t,n){"use strict";n.d(t,{db:function(){return d},l2:function(){return i}});var r=n(90791),a=n(78022),s=n(21897),o=n(8774),l=n(11582),c=n(17865);let i=(0,r.C6)().length?(0,r.Mq)():(0,r.ZF)({apiKey:"AIzaSyAqGxdFqDGXOiiKP5cKFvPkNkmTdY4aByw",authDomain:"saodoapp--app-quan-ly-hs.asia-southeast1.hosted.app",projectId:"app-quan-ly-hs",storageBucket:"app-quan-ly-hs.firebasestorage.app",messagingSenderId:"771200825229",appId:"1:771200825229:web:bdffe0944b21edff21afc4"});try{(0,c.yu)(i,{provider:new c.o4("6Lf-0_gpAAAAAB6_ZgV7e_FvX8xw_9x3X_yYjW4C"),isTokenAutoRefreshEnabled:!0})}catch(e){console.error("Lỗi khi khởi tạo App Check:",e)}(0,a.v0)(i);let d=(0,s.ad)(i);(0,o.cF)(i),(0,l.$C)(i)},29147:function(e,t,n){"use strict";n.d(t,{Es:function(){return c},Hg:function(){return d},ap:function(){return i},cn:function(){return s}});var r=n(10607),a=n(25579);function s(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,a.m6)((0,r.W)(t))}let o=new Date(2025,8,8),l=e=>{let t=new Date(e);return t.setHours(0,0,0,0),t},c=()=>{let e=[{value:"",label:"Tất cả c\xe1c tuần"}],t=e=>e<10?"0".concat(e):"".concat(e);for(let n=1;n<=35;n++){let r=new Date(l(o).getTime()+(n-1)*6048e5),a=new Date(r.getTime()+5184e5);e.push({value:String(n),label:"Tuần ".concat(n," (").concat(t(r.getDate()),"/").concat(t(r.getMonth()+1)," - ").concat(t(a.getDate()),"/").concat(t(a.getMonth()+1),")")})}return e},i=e=>{if(!e)return"";let t=e.match(/(?:class_)?(\d+)/);return t?t[1]:""},d=e=>e&&e.startsWith("class_")?e.substring(6).replace(/_/g,"/"):e}},function(e){e.O(0,[6415,5117,2997,1661,6951,1293,1528,1744],function(){return e(e.s=75702)}),_N_E=e.O()}]);
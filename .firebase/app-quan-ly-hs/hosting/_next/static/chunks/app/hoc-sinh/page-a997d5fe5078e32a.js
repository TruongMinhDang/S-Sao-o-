(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4752],{80192:function(e,s,t){Promise.resolve().then(t.bind(t,38987))},38987:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return S}});var l=t(27573),n=t(7653),i=t(21897),a=t(16851),r=t(50466),c=t(72196),d=t(39134),h=t(98609),o=t(50188),u=t(29324),m=t(81758),x=t(39416),p=t(38976);function j(){let[e,s]=(0,n.useState)(!1),[t,c]=(0,n.useState)(""),[h,o]=(0,n.useState)(""),[j,f]=(0,n.useState)(""),[g,v]=(0,n.useState)(!1),{toast:S}=(0,p.pm)(),N=()=>{c(""),o(""),f("")},T=async e=>{e.preventDefault();let l=t.trim(),n=h.trim(),r=j.trim();if(!l||!n||!r){S({title:"Lỗi",description:"Vui l\xf2ng điền đầy đủ th\xf4ng tin.",variant:"destructive"});return}v(!0);try{await (0,i.ET)((0,i.hJ)(a.db,"students"),{fullName:l,schoolId:n,classRef:r,totalMeritPoints:0,totalDemeritPoints:0,createdAt:(0,i.Bt)()}),S({title:"Th\xe0nh c\xf4ng",description:"Đ\xe3 th\xeam học sinh mới."}),N(),s(!1)}catch(s){console.error("Lỗi khi th\xeam học sinh:",s);let e=s instanceof Error?s.message:String(s);S({title:"Lỗi",description:"Kh\xf4ng thể th\xeam học sinh. Vui l\xf2ng thử lại. Lỗi: ".concat(e),variant:"destructive"})}finally{v(!1)}};return(0,l.jsxs)(u.Vq,{open:e,onOpenChange:s,children:[(0,l.jsx)(u.hg,{asChild:!0,children:(0,l.jsxs)(r.z,{children:[(0,l.jsx)(x.Z,{className:"mr-2 h-4 w-4"}),"Th\xeam Học Sinh Mới"]})}),(0,l.jsx)(u.cZ,{className:"sm:max-w-[425px]",children:(0,l.jsxs)("form",{onSubmit:T,children:[(0,l.jsxs)(u.fK,{children:[(0,l.jsx)(u.$N,{children:"Th\xeam Học Sinh Mới"}),(0,l.jsx)(u.Be,{children:'Nhập th\xf4ng tin chi tiết của học sinh mới. Nhấn "Lưu" để ho\xe0n tất.'})]}),(0,l.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,l.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,l.jsx)(m._,{htmlFor:"name",className:"text-right",children:"Họ v\xe0 T\xean"}),(0,l.jsx)(d.I,{id:"name",value:t,onChange:e=>c(e.target.value),placeholder:"Nguyễn Văn A",className:"col-span-3",autoFocus:!0})]}),(0,l.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,l.jsx)(m._,{htmlFor:"studentId",className:"text-right",children:"M\xe3 số HS"}),(0,l.jsx)(d.I,{id:"studentId",value:h,onChange:e=>o(e.target.value),placeholder:"HS001",className:"col-span-3"})]}),(0,l.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,l.jsx)(m._,{htmlFor:"class",className:"text-right",children:"Lớp"}),(0,l.jsx)(d.I,{id:"class",value:j,onChange:e=>f(e.target.value),placeholder:"class_6_1",className:"col-span-3"})]})]}),(0,l.jsx)(u.cN,{children:(0,l.jsx)(r.z,{type:"submit",disabled:g,"aria-busy":g,children:g?"Đang lưu...":"Lưu"})})]})})]})}var f=t(88146),g=t(76553),v=t(29147);function S(){let{isSuperAdmin:e,isViewerAdmin:s,isHomeroomTeacher:t,userProfile:u}=(0,g.a)(),[m,x]=(0,n.useState)([]),[p,S]=(0,n.useState)("all"),[N,T]=(0,n.useState)("all"),[C,y]=(0,n.useState)(""),[w,b]=(0,n.useState)(!0),[I,M]=(0,n.useState)(null);(0,n.useEffect)(()=>(0,i.cf)((0,i.hJ)(a.db,"students"),e=>{x(e.docs.map(e=>{var s,t,l,n,i;let a=e.data();return{id:e.id,studentId:null!==(s=a.schoolId)&&void 0!==s?s:"N/A",name:null!==(t=a.fullName)&&void 0!==t?t:"Kh\xf4ng c\xf3 t\xean",class:null!==(l=a.classRef)&&void 0!==l?l:"Chưa c\xf3 lớp",totalPlusPoints:null!==(n=a.totalMeritPoints)&&void 0!==n?n:0,totalMinusPoints:null!==(i=a.totalDemeritPoints)&&void 0!==i?i:0}})),b(!1),M(null)},e=>{console.error("Lỗi Firestore:",e),M("Kh\xf4ng thể tải dữ liệu: ".concat(e.message)),b(!1)}),[]);let _=(0,n.useMemo)(()=>new Intl.Collator("vi",{numeric:!0,sensitivity:"base"}),[]),A=(0,n.useMemo)(()=>{var e;return t&&(null==u?void 0:null===(e=u.assignedClasses)||void 0===e?void 0:e.length)?(0,v.ap)(u.assignedClasses[0]):""},[t,u]),k=(0,n.useMemo)(()=>t?[A].filter(Boolean):["all",...Array.from(new Set(m.map(e=>(0,v.ap)(e.class)).filter(Boolean))).sort((e,s)=>parseInt(e)-parseInt(s))],[m,t,A]),O=(0,n.useMemo)(()=>{let e=m;return"all"!==p&&(e=e.filter(e=>(0,v.ap)(e.class)===p)),["all",...Array.from(new Set(e.map(e=>e.class))).sort(_.compare)]},[m,p,_]),E=(0,n.useMemo)(()=>{let e=m;if(t&&A?e=e.filter(e=>(0,v.ap)(e.class)===A):"all"!==p&&(e=e.filter(e=>(0,v.ap)(e.class)===p)),"all"!==N&&(e=e.filter(e=>e.class===N)),""!==C.trim()){let s=C.toLowerCase();e=e.filter(e=>e.name.toLowerCase().includes(s)||e.studentId.toLowerCase().includes(s))}return e},[m,p,N,C,t,A]);return((0,n.useEffect)(()=>{t&&A?S(A):T("all")},[p,t,A]),w)?(0,l.jsx)("div",{children:"Đang tải dữ liệu..."}):I?(0,l.jsx)("div",{className:"text-red-500",children:I}):(0,l.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-2xl font-bold tracking-tight",children:"Quản L\xfd Học Sinh"}),(0,l.jsx)("p",{className:"text-muted-foreground",children:"Th\xeam, sửa v\xe0 quản l\xfd tất cả học sinh trong hệ thống."})]}),e&&(0,l.jsx)(j,{})]}),(0,l.jsxs)(c.Zb,{className:"bg-card",children:[(0,l.jsxs)(c.Ol,{children:[(0,l.jsx)(c.ll,{children:"Danh S\xe1ch Học Sinh"}),(0,l.jsx)(c.SZ,{children:"Hiển thị danh s\xe1ch học sinh v\xe0 hỗ trợ lọc, t\xecm kiếm theo khối – lớp – t\xean."})]}),(0,l.jsxs)(c.aY,{className:"space-y-4",children:[(e||s)&&(0,l.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"khoi-filter",className:"text-sm font-medium",children:"Lọc theo Khối"}),(0,l.jsxs)(h.Ph,{value:p,onValueChange:S,disabled:t,children:[(0,l.jsx)(h.i4,{id:"khoi-filter",children:(0,l.jsx)(h.ki,{placeholder:"Tất cả c\xe1c khối"})}),(0,l.jsx)(h.Bw,{children:k.map(e=>(0,l.jsx)(h.Ql,{value:e,children:"all"===e?"Tất cả c\xe1c khối":"Khối ".concat(e)},e))})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"lop-filter",className:"text-sm font-medium",children:"Lọc theo Lớp"}),(0,l.jsxs)(h.Ph,{value:N,onValueChange:T,children:[(0,l.jsx)(h.i4,{id:"lop-filter",children:(0,l.jsx)(h.ki,{placeholder:"Tất cả c\xe1c lớp"})}),(0,l.jsx)(h.Bw,{children:O.map(e=>(0,l.jsx)(h.Ql,{value:e,children:"all"===e?"Tất cả c\xe1c lớp":(0,v.Hg)(e)},e))})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"search",className:"text-sm font-medium",children:"T\xecm kiếm"}),(0,l.jsx)(d.I,{id:"search",placeholder:"T\xecm theo t\xean hoặc m\xe3 số...",value:C,onChange:e=>y(e.target.value)})]})]}),(0,l.jsx)("div",{className:"rounded-md border",children:(0,l.jsxs)(o.iA,{children:[(0,l.jsx)(o.xD,{children:(0,l.jsxs)(o.SC,{children:[(0,l.jsx)(o.ss,{className:"w-[50px]",children:"STT"}),(0,l.jsx)(o.ss,{children:"M\xe3 số HS"}),(0,l.jsx)(o.ss,{children:"Họ v\xe0 T\xean"}),(0,l.jsx)(o.ss,{children:"Lớp"}),(0,l.jsx)(o.ss,{children:"Tổng cộng"}),(0,l.jsx)(o.ss,{children:"Tổng trừ"}),(0,l.jsx)(o.ss,{children:"H\xe0nh động"})]})}),(0,l.jsx)(o.RM,{children:w?(0,l.jsx)(o.SC,{children:(0,l.jsx)(o.pj,{colSpan:7,className:"h-24 text-center",children:"Đang tải dữ liệu..."})}):I?(0,l.jsx)(o.SC,{children:(0,l.jsx)(o.pj,{colSpan:7,className:"h-24 text-center text-red-500",children:I})}):E.length>0?E.map((e,s)=>(0,l.jsxs)(o.SC,{children:[(0,l.jsx)(o.pj,{children:s+1}),(0,l.jsx)(o.pj,{children:e.studentId}),(0,l.jsx)(o.pj,{className:"font-medium",children:e.name}),(0,l.jsx)(o.pj,{children:(0,v.Hg)(e.class)}),(0,l.jsx)(o.pj,{children:e.totalPlusPoints}),(0,l.jsx)(o.pj,{children:e.totalMinusPoints}),(0,l.jsx)(o.pj,{children:(0,l.jsx)(r.z,{asChild:!0,variant:"ghost",size:"sm",children:(0,l.jsx)(f.default,{href:"/hoc-sinh/".concat(e.id),children:"Chi tiết"})})})]},e.id)):(0,l.jsx)(o.SC,{children:(0,l.jsx)(o.pj,{colSpan:7,className:"h-24 text-center",children:"Kh\xf4ng c\xf3 học sinh n\xe0o khớp với t\xecm kiếm."})})})]})}),(0,l.jsxs)("p",{className:"text-sm text-muted-foreground text-right",children:["Tổng số: ",E.length," học sinh"]})]})]})]})}},72196:function(e,s,t){"use strict";t.d(s,{Ol:function(){return r},SZ:function(){return d},Zb:function(){return a},aY:function(){return h},ll:function(){return c}});var l=t(27573),n=t(7653),i=t(29147);let a=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,l.jsx)("div",{ref:s,className:(0,i.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...n})});a.displayName="Card";let r=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,l.jsx)("div",{ref:s,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",t),...n})});r.displayName="CardHeader";let c=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,l.jsx)("h3",{ref:s,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",t),...n})});c.displayName="CardTitle";let d=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,l.jsx)("p",{ref:s,className:(0,i.cn)("text-sm text-muted-foreground",t),...n})});d.displayName="CardDescription";let h=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,l.jsx)("div",{ref:s,className:(0,i.cn)("p-6 pt-0",t),...n})});h.displayName="CardContent",n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,l.jsx)("div",{ref:s,className:(0,i.cn)("flex items-center p-6 pt-0",t),...n})}).displayName="CardFooter"},38976:function(e,s,t){"use strict";t.d(s,{pm:function(){return u}});var l=t(7653);let n=0,i=new Map,a=e=>{if(i.has(e))return;let s=setTimeout(()=>{i.delete(e),h({type:"REMOVE_TOAST",toastId:e})},1e6);i.set(e,s)},r=(e,s)=>{switch(s.type){case"ADD_TOAST":return{...e,toasts:[s.toast,...e.toasts].slice(0,10)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===s.toast.id?{...e,...s.toast}:e)};case"DISMISS_TOAST":{let{toastId:t}=s;return t?a(t):e.toasts.forEach(e=>{a(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===t||void 0===t?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===s.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==s.toastId)}}},c=[],d={toasts:[]};function h(e){d=r(d,e),c.forEach(e=>{e(d)})}function o(e){let s=(n=(n+1)%100).toString(),t=()=>h({type:"DISMISS_TOAST",toastId:s});return h({type:"ADD_TOAST",toast:{...e,id:s,open:!0,onOpenChange:e=>{e||t()}}}),{id:s,dismiss:t,update:e=>h({type:"UPDATE_TOAST",toast:{...e,id:s}})}}function u(){let[e,s]=l.useState(d);return l.useEffect(()=>(c.push(s),()=>{let e=c.indexOf(s);e>-1&&c.splice(e,1)}),[e]),{...e,toast:o,dismiss:e=>h({type:"DISMISS_TOAST",toastId:e})}}}},function(e){e.O(0,[6415,5117,2997,1661,6951,9445,8146,6158,7554,792,5142,1293,1528,1744],function(){return e(e.s=80192)}),_N_E=e.O()}]);
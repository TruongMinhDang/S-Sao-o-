(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7324],{59053:function(e,t,n){Promise.resolve().then(n.bind(n,39729))},39729:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return d}});var r=n(27573),a=n(76553),s=n(18224),i=n(72196);n(7653);var l=n(49289),c=n(29147);let o=(0,l.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function u(e){let{className:t,variant:n,...a}=e;return(0,r.jsx)("div",{className:(0,c.cn)(o({variant:n}),t),...a})}function d(){var e;let{user:t,userProfile:n,loading:l}=(0,a.a)(),c=e=>{switch(e){case"admin":return"Quản Trị Vi\xean Hệ Thống";case"hieu_truong":return"Hiệu Trưởng";case"pho_hieu_truong":return"Ph\xf3 Hiệu Trưởng";case"giao_vien_chu_nhiem":case"homeroom_teacher":return"Gi\xe1o Vi\xean Chủ Nhiệm";case"giam_thi":return"Gi\xe1m Thị";default:return"Người d\xf9ng"}};return l?(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)("img",{src:"https://firebasestorage.googleapis.com/v0/b/app-quan-ly-hs.firebasestorage.app/o/Icon%2Ficon.%20h%C3%B4%CC%80%20s%C6%A1%20ca%CC%81%20nh%C3%A2n.png?alt=media&token=4b829fc0-06e1-4706-85c0-8bf3a4222c03",alt:"Hồ sơ icon",className:"w-10 h-10"}),(0,r.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Hồ Sơ C\xe1 Nh\xe2n"})]}),(0,r.jsx)("p",{children:"Đang tải th\xf4ng tin của bạn..."})]}):t&&n?(0,r.jsxs)("div",{className:"space-y-6 max-w-2xl mx-auto",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)("img",{src:"https://firebasestorage.googleapis.com/v0/b/app-quan-ly-hs.firebasestorage.app/o/Icon%2Ficon.%20h%C3%B4%CC%80%20s%C6%A1%20ca%CC%81%20nh%C3%A2n.png?alt=media&token=4b829fc0-06e1-4706-85c0-8bf3a4222c03",alt:"Hồ sơ icon",className:"w-10 h-10"}),(0,r.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Hồ Sơ C\xe1 Nh\xe2n"})]}),(0,r.jsxs)(i.Zb,{children:[(0,r.jsx)(i.Ol,{children:(0,r.jsxs)("div",{className:"flex items-center space-x-6",children:[(0,r.jsxs)(s.qE,{className:"h-24 w-24",children:[(0,r.jsx)(s.F$,{src:t.photoURL||void 0,alt:n.displayName||"User"}),(0,r.jsx)(s.Q5,{className:"text-3xl",children:(e=n.displayName)?e.split(" ").map(e=>e[0]).join("").toUpperCase():"??"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(i.ll,{className:"text-2xl",children:n.displayName||"Kh\xf4ng c\xf3 t\xean"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:n.email||"Kh\xf4ng c\xf3 email"}),(0,r.jsx)(()=>{let e=c(null==n?void 0:n.role),t=["admin","hieu_truong","pho_hieu_truong"].includes((null==n?void 0:n.role)||"");return(0,r.jsx)(u,{variant:t?"destructive":"secondary",children:e})},{})]})]})}),(0,r.jsxs)(i.aY,{children:[(0,r.jsx)("h3",{className:"font-semibold mb-4",children:"Th\xf4ng tin chi tiết"}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"UID:"}),(0,r.jsx)("span",{className:"font-mono text-sm",children:t.uid})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"Email đ\xe3 x\xe1c thực:"}),(0,r.jsx)("span",{children:t.emailVerified?"Đ\xe3 x\xe1c thực":"Chưa x\xe1c thực"})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"Ng\xe0y tạo t\xe0i khoản:"}),(0,r.jsx)("span",{children:t.metadata.creationTime?new Date(t.metadata.creationTime).toLocaleDateString("vi-VN"):"Kh\xf4ng r\xf5"})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"Lần đăng nhập cuối:"}),(0,r.jsx)("span",{children:t.metadata.lastSignInTime?new Date(t.metadata.lastSignInTime).toLocaleString("vi-VN"):"Kh\xf4ng r\xf5"})]}),n.assignedClasses&&n.assignedClasses.length>0&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"Lớp chủ nhiệm:"}),(0,r.jsx)("span",{children:n.assignedClasses.join(", ")})]})]})]})]})]}):(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)("img",{src:"https://firebasestorage.googleapis.com/v0/b/app-quan-ly-hs.firebasestorage.app/o/Icon%2Ficon.%20h%C3%B4%CC%80%20s%C6%A1%20ca%CC%81%20nh%C3%A2n.png?alt=media&token=4b829fc0-06e1-4706-85c0-8bf3a4222c03",alt:"Hồ sơ icon",className:"w-10 h-10"}),(0,r.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Hồ Sơ C\xe1 Nh\xe2n"})]}),(0,r.jsx)("p",{children:"Kh\xf4ng t\xecm thấy th\xf4ng tin người d\xf9ng."})]})}},18224:function(e,t,n){"use strict";n.d(t,{F$:function(){return c},Q5:function(){return o},qE:function(){return l}});var r=n(27573),a=n(7653),s=n(6645),i=n(29147);let l=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(s.fC,{ref:t,className:(0,i.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",n),...a})});l.displayName=s.fC.displayName;let c=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(s.Ee,{ref:t,className:(0,i.cn)("aspect-square h-full w-full",n),...a})});c.displayName=s.Ee.displayName;let o=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(s.NY,{ref:t,className:(0,i.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",n),...a})});o.displayName=s.NY.displayName},72196:function(e,t,n){"use strict";n.d(t,{Ol:function(){return l},SZ:function(){return o},Zb:function(){return i},aY:function(){return u},ll:function(){return c}});var r=n(27573),a=n(7653),s=n(29147);let i=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",n),...a})});i.displayName="Card";let l=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("flex flex-col space-y-1.5 p-6",n),...a})});l.displayName="CardHeader";let c=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("h3",{ref:t,className:(0,s.cn)("text-2xl font-semibold leading-none tracking-tight",n),...a})});c.displayName="CardTitle";let o=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("p",{ref:t,className:(0,s.cn)("text-sm text-muted-foreground",n),...a})});o.displayName="CardDescription";let u=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("p-6 pt-0",n),...a})});u.displayName="CardContent",a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("flex items-center p-6 pt-0",n),...a})}).displayName="CardFooter"},76553:function(e,t,n){"use strict";n.d(t,{H:function(){return p},a:function(){return x}});var r=n(27573),a=n(7653),s=n(78022),i=n(66356),l=n(81695);let c=(0,a.createContext)(void 0),o=["/login","/auth/action"],u={admin:"/tong-quan",viewerAdmin:"/tong-quan",teacher:"/lop-cua-toi",default:"/tong-quan"},d=e=>"admin"===e,h=e=>["hieu_truong","pho_hieu_truong","nv_tin_hoc"].includes(e||""),f=e=>["giao_vien_chu_nhiem","homeroom_teacher"].includes(e||""),m=e=>"giam_thi"===e;function g(){let e=(0,s.v0)(i.l),[t,n]=(0,a.useState)(""),l=async()=>{if(e.currentUser)try{await (0,s.w$)(e.currentUser),n("Đ\xe3 gửi lại email x\xe1c thực. Vui l\xf2ng kiểm tra hộp thư của bạn.")}catch(e){console.error(e),n("Lỗi: ".concat(e.message))}},c=async()=>{try{await e.signOut()}catch(e){console.error("Error signing out:",e)}};return(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100vh",textAlign:"center",padding:"20px",backgroundColor:"#f0f2f5"},children:[(0,r.jsx)("h1",{style:{fontSize:"24px",marginBottom:"20px"},children:"Y\xeau cầu X\xe1c thực Email"}),(0,r.jsx)("p",{style:{marginBottom:"20px"},children:"T\xe0i khoản của bạn chưa được x\xe1c thực. Vui l\xf2ng kiểm tra hộp thư v\xe0 nhấn v\xe0o li\xean kết x\xe1c thực để tiếp tục."}),(0,r.jsxs)("div",{style:{display:"flex",gap:"10px"},children:[(0,r.jsx)("button",{onClick:l,style:{padding:"10px 20px",backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"5px",cursor:"pointer"},children:"Gửi lại Email"}),(0,r.jsx)("button",{onClick:c,style:{padding:"10px 20px",backgroundColor:"#6c757d",color:"white",border:"none",borderRadius:"5px",cursor:"pointer"},children:"Đăng xuất"})]}),t&&(0,r.jsx)("p",{style:{marginTop:"20px",color:"green"},children:t})]})}function p(e){let{children:t}=e,[n,p]=(0,a.useState)(null),[x,_]=(0,a.useState)(null),[E,N]=(0,a.useState)(!0),[C,v]=(0,a.useState)(!1),j=(0,l.useRouter)(),I=(0,l.usePathname)();(0,a.useEffect)(()=>{let e=(0,s.v0)(i.l),t=(0,s.Aj)(e,async t=>{if(t)try{await t.reload();let a=e.currentUser;if(a&&(p(a),v(a.emailVerified),a.emailVerified)){var n,r;let e=(await a.getIdTokenResult()).claims,t=e.assignedClasses,s=[];Array.isArray(t)?s=t:"string"==typeof t&&t.length>0&&(s=t.split(",").map(e=>e.trim()));let i={displayName:null!==(n=a.displayName)&&void 0!==n?n:void 0,email:null!==(r=a.email)&&void 0!==r?r:void 0,role:e.role,assignedClasses:s};_(i),i.role||console.warn("User logged in but has no 'role' claim. UID: ".concat(a.uid))}}catch(e){console.error("Error processing auth state:",e),_(null),p(null)}else _(null),p(null),v(!1);N(!1)});return()=>t()},[]);let b=null==x?void 0:x.role,y=d(b),T=h(b),A=f(b),S=m(b),B=y||T;return((0,a.useEffect)(()=>{if(E)return;let e=o.includes(I);n&&C?(e||"/"===I)&&(y?j.push(u.admin):T?j.push(u.viewerAdmin):A?j.push(u.teacher):j.push(u.default)):n||e||j.push("/login")},[n,C,E,I,j,y,T,A]),E)?(0,r.jsx)("div",{children:"Đang tải..."}):n&&!C?o.includes(I)?(0,r.jsx)(r.Fragment,{children:t}):(0,r.jsx)(g,{}):(0,r.jsx)(c.Provider,{value:{user:n,userProfile:x,isAdmin:B,isSuperAdmin:y,isViewerAdmin:T,isHomeroomTeacher:A,isProctor:S,loading:E},children:t})}function x(){let e=(0,a.useContext)(c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},66356:function(e,t,n){"use strict";n.d(t,{l:function(){return d},I:function(){return f},db:function(){return h}});var r=n(90791),a=n(21897),s=n(78022),i=n(17865),l=n(68571);function c(e){let t=l.env[e];if(!t||""===t.trim())throw Error("Thiếu biến m\xf4i trường ".concat(e,". Kiểm tra .env.local / secrets."));return t}let o={NEXT_PUBLIC_FIREBASE_API_KEY:c("NEXT_PUBLIC_FIREBASE_API_KEY"),NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN:c("NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN"),NEXT_PUBLIC_FIREBASE_PROJECT_ID:c("NEXT_PUBLIC_FIREBASE_PROJECT_ID"),NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET:c("NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET"),NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID:c("NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID"),NEXT_PUBLIC_FIREBASE_APP_ID:c("NEXT_PUBLIC_FIREBASE_APP_ID"),NEXT_PUBLIC_RECAPTCHA_SITE_KEY:c("NEXT_PUBLIC_RECAPTCHA_SITE_KEY")},u={apiKey:o.NEXT_PUBLIC_FIREBASE_API_KEY,authDomain:o.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,projectId:o.NEXT_PUBLIC_FIREBASE_PROJECT_ID,storageBucket:o.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,messagingSenderId:o.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,appId:o.NEXT_PUBLIC_FIREBASE_APP_ID},d=(0,r.C6)().length?(0,r.Mq)():(0,r.ZF)(u);{let e=globalThis;e.__firebaseAppCheckInitialized||(e.__firebaseAppCheckInitialized=!0,(0,i.yu)(d,{provider:new i.o4(o.NEXT_PUBLIC_RECAPTCHA_SITE_KEY),isTokenAutoRefreshEnabled:!0}))}let h=(0,a.ad)(d),f=(0,s.v0)(d)},29147:function(e,t,n){"use strict";n.d(t,{Es:function(){return c},Hg:function(){return u},ap:function(){return o},cn:function(){return s}});var r=n(10607),a=n(25579);function s(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,a.m6)((0,r.W)(t))}let i=new Date(2025,8,8),l=e=>{let t=new Date(e);return t.setHours(0,0,0,0),t},c=()=>{let e=[{value:"",label:"Tất cả c\xe1c tuần"}],t=e=>e<10?"0".concat(e):"".concat(e);for(let n=1;n<=35;n++){let r=new Date(l(i).getTime()+(n-1)*6048e5),a=new Date(r.getTime()+5184e5);e.push({value:String(n),label:"Tuần ".concat(n," (").concat(t(r.getDate()),"/").concat(t(r.getMonth()+1)," - ").concat(t(a.getDate()),"/").concat(t(a.getMonth()+1),")")})}return e},o=e=>{if(!e)return"";let t=e.match(/(?:class_)?(\d+)/);return t?t[1]:""},u=e=>e&&e.startsWith("class_")?e.substring(6).replace(/_/g,"/"):e},523:function(e,t,n){"use strict";n.d(t,{W:function(){return a}});var r=n(7653);function a(e){let t=r.useRef(e);return r.useEffect(()=>{t.current=e}),r.useMemo(()=>(...e)=>t.current?.(...e),[])}},81523:function(e,t,n){"use strict";n.d(t,{b:function(){return a}});var r=n(7653),a=globalThis?.document?r.useLayoutEffect:()=>{}}},function(e){e.O(0,[6415,5117,2997,1661,2654,1293,1528,1744],function(){return e(e.s=59053)}),_N_E=e.O()}]);
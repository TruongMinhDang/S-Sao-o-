(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1283],{77284:function(e,t,r){Promise.resolve().then(r.bind(r,13455))},13455:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return v}});var a=r(27573),n=r(7653),s=r(98609),o=r(50466),l=r(21897),i=r(16851),d=r(29147);let c=(0,l.ad)(i.l2),u=new Date(new Date().getFullYear(),8,8),m=e=>{let t=new Date(e);return t.setHours(0,0,0,0),t},h=()=>{let e=[];for(let t=1;t<=35;t++){let r=new Date(m(u).getTime()+(t-1)*6048e5),a=new Date(r.getTime()+5184e5),n=e=>e<10?"0".concat(e):"".concat(e);e.push("Tuần ".concat(t," (").concat(n(r.getDate()),"/").concat(n(r.getMonth()+1)," - ").concat(n(a.getDate()),"/").concat(n(a.getMonth()+1),")"))}return e},f=e=>"class_".concat(e.replace("/","_")),b=[{name:"Khối 6",classes:["6/1","6/2","6/3","6/4","6/5","6/6","6/7","6/8","6/9","6/10"]},{name:"Khối 7",classes:["7/1","7/2","7/3","7/4","7/5","7/6","7/7","7/8"]},{name:"Khối 8",classes:["8/1","8/2","8/3","8/4","8/5","8/6","8/7"]},{name:"Khối 9",classes:["9/1","9/2","9/3","9/4","9/5","9/6","9/7","9/8"]}],g=[{key:"hoc_tap",label:"HỌC TẬP",editable:!0},{key:"ky_luat",label:"KỶ LUẬT",editable:!0},{key:"ve_sinh",label:"VỆ SINH",editable:!0},{key:"diem_cong",label:"ĐIỂM CỘNG",editable:!1},{key:"diem_tru",label:"ĐIỂM TRỪ",editable:!1},{key:"tong_diem",label:"TỔNG ĐIỂM",editable:!1},{key:"hang",label:"HẠNG",editable:!1},{key:"nhan_xet",label:"NHẬN X\xc9T",editable:!0}],x=h(),p=(()=>{let e=Math.max(1,Math.min(35,Math.floor(Math.floor((m(new Date).getTime()-m(u).getTime())/864e5)/7)+1));return h().find(t=>t.startsWith("Tuần ".concat(e," ")))||h()[0]})();function y(e){var t,r,s,l;let{isOpen:i,onClose:d,onSave:c,classData:u}=e,[m,h]=(0,n.useState)({});if((0,n.useEffect)(()=>{u&&h({hoc_tap:u.scores.hoc_tap||0,ky_luat:u.scores.ky_luat||0,ve_sinh:u.scores.ve_sinh||0,nhan_xet:u.scores.nhan_xet||""})},[u]),!i||!u)return null;let f=e=>{let{name:t,value:r}=e.target,a=["hoc_tap","ky_luat","ve_sinh"].includes(t);h(e=>({...e,[t]:a?""===r?void 0:Number(r):r}))};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl p-6 w-full max-w-md",children:[(0,a.jsxs)("h3",{className:"text-xl font-bold mb-4",children:["Cập nhật điểm cho lớp ",u.className]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Học tập"}),(0,a.jsx)("input",{type:"number",name:"hoc_tap",value:null!==(t=m.hoc_tap)&&void 0!==t?t:"",onChange:f,className:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Kỷ luật"}),(0,a.jsx)("input",{type:"number",name:"ky_luat",value:null!==(r=m.ky_luat)&&void 0!==r?r:"",onChange:f,className:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Vệ sinh"}),(0,a.jsx)("input",{type:"number",name:"ve_sinh",value:null!==(s=m.ve_sinh)&&void 0!==s?s:"",onChange:f,className:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Nhận x\xe9t"}),(0,a.jsx)("input",{type:"text",name:"nhan_xet",value:null!==(l=m.nhan_xet)&&void 0!==l?l:"",onChange:f,className:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"})]})]}),(0,a.jsxs)("div",{className:"mt-6 flex justify-end space-x-4",children:[(0,a.jsx)(o.z,{variant:"outline",onClick:d,children:"Hủy"}),(0,a.jsx)(o.z,{onClick:()=>{var e,t,r;c({hoc_tap:null!==(e=m.hoc_tap)&&void 0!==e?e:0,ky_luat:null!==(t=m.ky_luat)&&void 0!==t?t:0,ve_sinh:null!==(r=m.ve_sinh)&&void 0!==r?r:0,nhan_xet:m.nhan_xet}),d()},children:"Lưu thay đổi"})]})]})})}function v(){let[e,t]=(0,n.useState)(p),[r,i]=(0,n.useState)({}),[u,m]=(0,n.useState)({}),[h,v]=(0,n.useState)(!1),[w,N]=(0,n.useState)(null),[_,j]=(0,n.useState)(null);(0,n.useEffect)(()=>{var t;j(null);let r=null===(t=e.match(/\d+/))||void 0===t?void 0:t[0];if(!r)return;let a=(0,l.IO)((0,l.hJ)(c,"weeklyScores"),(0,l.ar)("week","==",Number(r))),n=(0,l.cf)(a,e=>{let t={};b.forEach(e=>{t[e.name]={}}),e.forEach(e=>{let r=e.data();r.gradeName&&r.className&&r.scores&&(t[r.gradeName]||(t[r.gradeName]={}),t[r.gradeName][r.className]=r.scores)}),i(t)},e=>{console.error("onSnapshot error (weeklyScores):",e),i({}),"failed-precondition"===e.code?j("Thiếu index cho truy vấn. Mở Console → bấm link 'Create index'."):"permission-denied"===e.code?j("Kh\xf4ng đủ quyền đọc dữ liệu. Kiểm tra Firestore Rules."):j("Lỗi đọc dữ liệu: ".concat(e.message||String(e)))});return()=>n()},[e]),(0,n.useEffect)(()=>{var t;let r=null===(t=e.match(/\d+/))||void 0===t?void 0:t[0];if(!r)return;let a=parseInt(r,10),n=(0,l.IO)((0,l.hJ)(c,"records"),(0,l.ar)("week","==",a)),s=(0,l.cf)(n,e=>{let t={};b.forEach(e=>{t[e.name]={},e.classes.forEach(r=>{t[e.name][r]={diem_cong:0,diem_tru:0}})}),e.forEach(e=>{let r=e.data();if(!r.classRef||!r.type)return;let a="Khối ".concat((0,d.ap)(r.classRef)),n=(0,d.Hg)(r.classRef);if(t[a]&&t[a][n]){let e=Number(r.pointsApplied||0);"merit"===r.type?t[a][n].diem_cong+=e:"demerit"===r.type&&(t[a][n].diem_tru+=Math.abs(e))}}),m(t)},e=>{console.error("onSnapshot error (records):",e),m({}),"failed-precondition"===e.code?j("Thiếu index cho truy vấn. Mở Console → bấm link 'Create index'."):"permission-denied"===e.code?j("Kh\xf4ng đủ quyền đọc dữ liệu. Kiểm tra Firestore Rules."):j("Lỗi đọc dữ liệu: ".concat(e.message||String(e)))});return()=>s()},[e]);let k=(0,n.useMemo)(()=>{let e={};return b.forEach(t=>{let a="Khối 9"===t.name?330:340,n=[];t.classes.forEach(e=>{var s,o,l,i,d;let c=(null===(s=r[t.name])||void 0===s?void 0:s[e])||{},m=(null===(o=u[t.name])||void 0===o?void 0:o[e])||{diem_cong:0,diem_tru:0},h=null!==(l=c.hoc_tap)&&void 0!==l?l:a,f=null!==(i=c.ky_luat)&&void 0!==i?i:a,b=null!==(d=c.ve_sinh)&&void 0!==d?d:a,g=h+f+b+m.diem_cong-m.diem_tru;n.push({className:e,hoc_tap:h,ky_luat:f,ve_sinh:b,nhan_xet:c.nhan_xet,...m,tong_diem:g})}),n.sort((e,t)=>t.tong_diem-e.tong_diem),e[t.name]={};let s=0,o=1/0;n.forEach((r,a)=>{r.tong_diem<o&&(s=a+1),e[t.name][r.className]={...r,hang:s},o=r.tong_diem})}),e},[r,u]),C=(e,t)=>{var r;let a=(null===(r=k[e])||void 0===r?void 0:r[t])||{};N({gradeName:e,className:t,scores:a}),v(!0)},T=async t=>{var r;if(!w)return;let{gradeName:a,className:n}=w,s=null===(r=e.match(/\d+/))||void 0===r?void 0:r[0];if(!s){alert("Tuần kh\xf4ng hợp lệ.");return}let o=f(n),i="week_".concat(s,"_").concat(o),d=(0,l.JU)(c,"weeklyScores",i),u={week:Number(s),classId:o,className:n,gradeName:a,scores:t};try{await (0,l.pl)(d,u,{merge:!0}),v(!1)}catch(e){console.error("Error writing document: ",e),alert("Đ\xe3 c\xf3 lỗi xảy ra khi lưu điểm.")}},K={"Khối 6":{text:"text-red-700",border:"border-red-300",bg:"bg-red-50"},"Khối 7":{text:"text-yellow-700",border:"border-yellow-400",bg:"bg-yellow-50"},"Khối 8":{text:"text-blue-700",border:"border-blue-300",bg:"bg-blue-50"},"Khối 9":{text:"text-green-700",border:"border-green-300",bg:"bg-green-50"}};return(0,a.jsxs)("div",{className:"container mx-auto p-4 md:p-8 bg-gray-50 min-h-screen",children:[(0,a.jsx)(y,{isOpen:h,onClose:()=>v(!1),onSave:T,classData:w}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-center mb-6",children:[(0,a.jsx)("h1",{className:"text-2xl md:text-3xl font-bold text-gray-800 mb-4 sm:mb-0",children:"Bảng Xếp Hạng Thi Đua"}),(0,a.jsxs)(s.Ph,{onValueChange:t,value:e,children:[(0,a.jsx)(s.i4,{className:"w-full sm:w-[320px] bg-white shadow-sm border-gray-300",children:(0,a.jsx)(s.ki,{placeholder:"Chọn tuần"})}),(0,a.jsx)(s.Bw,{className:"max-h-96 bg-white",children:x.map(e=>(0,a.jsx)(s.Ql,{value:e,children:e},e))})]})]}),_&&(0,a.jsx)("div",{className:"text-center py-4 bg-red-50 text-red-700 rounded-lg border border-red-200",children:_}),!_&&(0,a.jsx)("div",{className:"flex flex-col gap-12",children:b.map(e=>{let t=K[e.name]||K["Khối 9"];return(0,a.jsxs)("div",{className:"bg-white p-4 sm:p-6 rounded-xl shadow-lg border border-gray-200 transition-all duration-300 hover:shadow-2xl hover:-translate-y-2",children:[(0,a.jsxs)("h2",{className:"text-xl sm:text-2xl font-bold text-center ".concat(t.text," mb-6"),children:["SƠ KẾT H\xc0NG TUẦN - ",e.name.toUpperCase()]}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("div",{className:"grid border-l border-t ".concat(t.border),style:{gridTemplateColumns:"minmax(120px, 1.5fr) repeat(".concat(e.classes.length,", minmax(90px, 1fr))")},children:[(0,a.jsx)("div",{className:"font-bold text-gray-700 p-3 border-r border-b ".concat(t.border," ").concat(t.bg," flex items-center justify-start"),children:"NỘI DUNG"}),e.classes.map(r=>(0,a.jsxs)("div",{className:"font-bold text-gray-800 p-3 border-r border-b ".concat(t.border," ").concat(t.bg," flex items-center justify-center relative group"),children:[r,(0,a.jsx)(o.z,{variant:"ghost",size:"sm",className:"ml-1 h-6 w-6 p-0 absolute right-1 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>C(e.name,r),children:"✏️"})]},r)),g.map(r=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"font-semibold p-3 border-r border-b ".concat(t.border," flex items-center ").concat("hang"===r.key?"bg-yellow-100 text-yellow-900":"bg-white"),children:r.label},r.key),e.classes.map(n=>{var s,o;let l=null===(s=k[e.name])||void 0===s?void 0:s[n],i=null!==(o=null==l?void 0:l[r.key])&&void 0!==o?o:"nhan_xet"===r.key?"":0,d=i,c="p-3 text-center border-r border-b ".concat(t.border," flex items-center justify-center font-medium");return"hang"===r.key&&(c+=" bg-yellow-200 font-bold text-yellow-900"),"diem_cong"===r.key&&i>0&&(d="+".concat(i),c+=" text-green-600 font-bold"),"diem_tru"===r.key&&i>0&&(d="-".concat(i),c+=" text-red-600 font-bold"),"tong_diem"===r.key&&(c+=" font-bold text-blue-800"),r.editable&&(c+=" cursor-pointer hover:bg-gray-100 transition-colors"),(0,a.jsx)("div",{className:c,onClick:()=>r.editable&&C(e.name,n),children:d},n)})]}))]})})]},e.name)})})]})}},50466:function(e,t,r){"use strict";r.d(t,{z:function(){return d}});var a=r(27573),n=r(7653),s=r(8828),o=r(49289),l=r(29147);let i=(0,o.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 active:bg-blue-700",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=n.forwardRef((e,t)=>{let{className:r,variant:n,size:o,asChild:d=!1,...c}=e,u=d?s.g7:"button";return(0,a.jsx)(u,{className:(0,l.cn)(i({variant:n,size:o,className:r})),ref:t,...c})});d.displayName="Button"},98609:function(e,t,r){"use strict";r.d(t,{Bw:function(){return b},Ph:function(){return c},Ql:function(){return g},i4:function(){return m},ki:function(){return u}});var a=r(27573),n=r(7653),s=r(62968),o=r(38983),l=r(34965),i=r(87354),d=r(29147);let c=s.fC;s.ZA;let u=s.B4,m=n.forwardRef((e,t)=>{let{className:r,children:n,...l}=e;return(0,a.jsxs)(s.xz,{ref:t,className:(0,d.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",r),...l,children:[n,(0,a.jsx)(s.JO,{asChild:!0,children:(0,a.jsx)(o.Z,{className:"h-4 w-4 opacity-50"})})]})});m.displayName=s.xz.displayName;let h=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)(s.u_,{ref:t,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",r),...n,children:(0,a.jsx)(l.Z,{className:"h-4 w-4"})})});h.displayName=s.u_.displayName;let f=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)(s.$G,{ref:t,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",r),...n,children:(0,a.jsx)(o.Z,{className:"h-4 w-4"})})});f.displayName=s.$G.displayName;let b=n.forwardRef((e,t)=>{let{className:r,children:n,position:o="popper",...l}=e;return(0,a.jsx)(s.h_,{children:(0,a.jsxs)(s.VY,{ref:t,className:(0,d.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===o&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",r),position:o,...l,children:[(0,a.jsx)(h,{}),(0,a.jsx)(s.l_,{className:(0,d.cn)("p-1","popper"===o&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:n}),(0,a.jsx)(f,{})]})})});b.displayName=s.VY.displayName,n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)(s.__,{ref:t,className:(0,d.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",r),...n})}).displayName=s.__.displayName;let g=n.forwardRef((e,t)=>{let{className:r,children:n,...o}=e;return(0,a.jsxs)(s.ck,{ref:t,className:(0,d.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm text-foreground outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),...o,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(s.wU,{children:(0,a.jsx)(i.Z,{className:"h-4 w-4"})})}),(0,a.jsx)(s.eT,{children:n})]})});g.displayName=s.ck.displayName,n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)(s.Z0,{ref:t,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",r),...n})}).displayName=s.Z0.displayName},16851:function(e,t,r){"use strict";r.d(t,{db:function(){return c},l2:function(){return d}});var a=r(90791),n=r(78022),s=r(21897),o=r(8774),l=r(11582),i=r(17865);let d=(0,a.C6)().length?(0,a.Mq)():(0,a.ZF)({apiKey:"AIzaSyAqGxdFqDGXOiiKP5cKFvPkNkmTdY4aByw",authDomain:"saodoapp--app-quan-ly-hs.asia-southeast1.hosted.app",projectId:"app-quan-ly-hs",storageBucket:"app-quan-ly-hs.firebasestorage.app",messagingSenderId:"771200825229",appId:"1:771200825229:web:bdffe0944b21edff21afc4"});try{(0,i.yu)(d,{provider:new i.o4("6Lf-0_gpAAAAAB6_ZgV7e_FvX8xw_9x3X_yYjW4C"),isTokenAutoRefreshEnabled:!0})}catch(e){console.error("Lỗi khi khởi tạo App Check:",e)}(0,n.v0)(d);let c=(0,s.ad)(d);(0,o.cF)(d),(0,l.$C)(d)},29147:function(e,t,r){"use strict";r.d(t,{Es:function(){return i},Hg:function(){return c},ap:function(){return d},cn:function(){return s}});var a=r(10607),n=r(25579);function s(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,n.m6)((0,a.W)(t))}let o=new Date(2025,8,8),l=e=>{let t=new Date(e);return t.setHours(0,0,0,0),t},i=()=>{let e=[{value:"",label:"Tất cả c\xe1c tuần"}],t=e=>e<10?"0".concat(e):"".concat(e);for(let r=1;r<=35;r++){let a=new Date(l(o).getTime()+(r-1)*6048e5),n=new Date(a.getTime()+5184e5);e.push({value:String(r),label:"Tuần ".concat(r," (").concat(t(a.getDate()),"/").concat(t(a.getMonth()+1)," - ").concat(t(n.getDate()),"/").concat(t(n.getMonth()+1),")")})}return e},d=e=>{if(!e)return"";let t=e.match(/(?:class_)?(\d+)/);return t?t[1]:""},c=e=>e&&e.startsWith("class_")?e.substring(6).replace(/_/g,"/"):e}},function(e){e.O(0,[6415,5117,2997,1661,6951,9445,6158,7554,1293,1528,1744],function(){return e(e.s=77284)}),_N_E=e.O()}]);
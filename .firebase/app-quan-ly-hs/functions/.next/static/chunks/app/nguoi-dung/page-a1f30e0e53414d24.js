(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3613],{84732:function(e,s,l){Promise.resolve().then(l.bind(l,27221))},27221:function(e,s,l){"use strict";l.r(s),l.d(s,{default:function(){return v}});var i=l(27573),n=l(7653),a=l(16851),t=l(21897),r=l(50466),c=l(39134),d=l(50188),h=l(29324),o=l(98609),m=l(81758),u=l(39416),x=l(95731),g=l(76553);let j={giam_thi:"Gi\xe1m thị",homeroom_teacher:"Gi\xe1o vi\xean chủ nhiệm",hieu_truong:"Hiệu trưởng",pho_hieu_truong:"Ph\xf3 hiệu trưởng",nhan_vien_cntt:"Nh\xe2n vi\xean CNTT",admin:"Quản trị tối cao"},p=e=>j[e]||e;function v(){let{user:e,loading:s,isSuperAdmin:l}=(0,g.a)(),[j,v]=(0,n.useState)([]),[N,f]=(0,n.useState)(!0),[y,C]=(0,n.useState)(null),[_,b]=(0,n.useState)(""),[w,T]=(0,n.useState)(!1),[S,k]=(0,n.useState)(null);(0,n.useEffect)(()=>{if(s){f(!0);return}if(!l){C("Truy cập bị từ chối."),f(!1),v([]);return}let e=(0,t.IO)((0,t.hJ)(a.db,"users")),i=(0,t.cf)(e,e=>{v(e.docs.map(e=>({id:e.id,...e.data()}))),C(null),f(!1)},e=>{console.error("Lỗi snapshot:",e),C("Kh\xf4ng thể tải danh s\xe1ch người d\xf9ng."),f(!1)});return()=>i()},[s,l]);let Q=(0,n.useMemo)(()=>{if(!_)return j;let e=_.toLowerCase();return j.filter(s=>{var l,i;return(null===(l=s.displayName)||void 0===l?void 0:l.toLowerCase().includes(e))||(null===(i=s.email)||void 0===i?void 0:i.toLowerCase().includes(e))})},[j,_]),L=e=>{k(e),T(!0)},D=async()=>{if(S)try{if(!S.displayName||!S.email||!S.role){alert("Vui l\xf2ng nhập đầy đủ họ t\xean, email, v\xe0 vai tr\xf2.");return}let e={...S};if(S.id){let s=(0,t.JU)(a.db,"users",S.id);await (0,t.pl)(s,e,{merge:!0})}else await (0,t.ET)((0,t.hJ)(a.db,"users"),e);T(!1),k(null)}catch(e){console.error("Lỗi lưu người d\xf9ng:",e),alert("Đ\xe3 c\xf3 lỗi khi lưu th\xf4ng tin.")}};return s||N?(0,i.jsx)("div",{className:"p-8 text-center",children:"Đang tải..."}):l?(0,i.jsxs)("div",{className:"p-4 md:p-8",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,i.jsxs)("div",{className:"flex items-center gap-4",children:[(0,i.jsx)("img",{src:"https://firebasestorage.googleapis.com/v0/b/app-quan-ly-hs.firebasestorage.app/o/Icon%2Ficon%20ng%C6%B0%C6%A1%CC%80i%20du%CC%80ng.svg?alt=media&token=9d449ba6-b8ca-42c2-ad77-9624dd830a1e",alt:"Người d\xf9ng icon",className:"w-10 h-10"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{className:"text-3xl font-bold text-orange-600",children:"Quản L\xfd Người D\xf9ng"}),(0,i.jsx)("p",{className:"text-gray-500 mt-1",children:"Chỉ Quản trị vi\xean tối cao mới c\xf3 thể truy cập trang n\xe0y."})]})]}),l&&(0,i.jsxs)(r.z,{onClick:()=>{k({}),T(!0)},children:[(0,i.jsx)(u.Z,{className:"mr-2 h-4 w-4"}),"Th\xeam Người D\xf9ng Mới"]})]}),(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[(0,i.jsxs)("div",{className:"flex flex-col md:flex-row items-center justify-between mb-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{className:"text-2xl font-bold",children:"Danh S\xe1ch Người D\xf9ng"}),(0,i.jsx)("p",{className:"text-gray-500 mt-1",children:"Tất cả người d\xf9ng đ\xe3 đăng k\xfd trong hệ thống."})]}),(0,i.jsxs)("div",{className:"relative mt-4 md:mt-0",children:[(0,i.jsx)(x.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"}),(0,i.jsx)(c.I,{placeholder:"T\xecm theo t\xean hoặc email...",value:_,onChange:e=>b(e.target.value),className:"pl-10 w-full md:w-80"})]})]}),(0,i.jsx)("div",{children:(0,i.jsxs)(d.iA,{children:[(0,i.jsx)(d.xD,{children:(0,i.jsxs)(d.SC,{children:[(0,i.jsx)(d.ss,{children:"T\xean hiển thị"}),(0,i.jsx)(d.ss,{children:"Email"}),(0,i.jsx)(d.ss,{children:"Vai tr\xf2"}),(0,i.jsx)(d.ss,{children:"Trạng th\xe1i"}),(0,i.jsx)(d.ss,{children:"Lớp Phụ Tr\xe1ch"}),(0,i.jsx)(d.ss,{className:"text-right",children:"H\xe0nh động"})]})}),(0,i.jsx)(d.RM,{children:y?(0,i.jsx)(d.SC,{children:(0,i.jsx)(d.pj,{colSpan:6,className:"text-center py-10 text-red-500",children:y})}):0===Q.length?(0,i.jsx)(d.SC,{children:(0,i.jsx)(d.pj,{colSpan:6,className:"text-center py-10 text-gray-500",children:"Kh\xf4ng t\xecm thấy người d\xf9ng n\xe0o."})}):Q.map(e=>{var s;return(0,i.jsxs)(d.SC,{children:[(0,i.jsx)(d.pj,{className:"font-medium",children:e.displayName||"-"}),(0,i.jsx)(d.pj,{children:e.email||"-"}),(0,i.jsx)(d.pj,{children:e.role?p(e.role):"-"}),(0,i.jsx)(d.pj,{children:(0,i.jsx)("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-gray-200 text-gray-700",children:"Chưa r\xf5"})}),(0,i.jsx)(d.pj,{children:(null===(s=e.assignedClasses)||void 0===s?void 0:s.join(", "))||"-"}),(0,i.jsx)(d.pj,{className:"text-right",children:l&&(0,i.jsx)(r.z,{variant:"outline",size:"sm",onClick:()=>L(e),children:"Sửa"})})]},e.id)})})]})})]}),(0,i.jsx)(h.Vq,{open:w,onOpenChange:T,children:(0,i.jsxs)(h.cZ,{className:"bg-white",children:[(0,i.jsx)(h.fK,{children:(0,i.jsx)(h.$N,{children:(null==S?void 0:S.id)?"Sửa Th\xf4ng Tin Người D\xf9ng":"Th\xeam Người D\xf9ng Mới"})}),(0,i.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,i.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,i.jsx)(m._,{htmlFor:"displayName",className:"text-right",children:"T\xean hiển thị"}),(0,i.jsx)(c.I,{id:"displayName",value:(null==S?void 0:S.displayName)||"",onChange:e=>k({...S,displayName:e.target.value}),className:"col-span-3"})]}),(0,i.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,i.jsx)(m._,{htmlFor:"email",className:"text-right",children:"Email"}),(0,i.jsx)(c.I,{id:"email",type:"email",value:(null==S?void 0:S.email)||"",onChange:e=>k({...S,email:e.target.value}),className:"col-span-3"})]}),(0,i.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,i.jsx)(m._,{htmlFor:"role",className:"text-right",children:"Vai tr\xf2"}),(0,i.jsxs)(o.Ph,{value:(null==S?void 0:S.role)||"",onValueChange:e=>k({...S,role:e}),children:[(0,i.jsx)(o.i4,{className:"col-span-3",children:(0,i.jsx)(o.ki,{placeholder:"Chọn vai tr\xf2"})}),(0,i.jsxs)(o.Bw,{children:[(0,i.jsx)(o.Ql,{value:"homeroom_teacher",children:"Gi\xe1o vi\xean chủ nhiệm"}),(0,i.jsx)(o.Ql,{value:"giam_thi",children:"Gi\xe1m thị"}),(0,i.jsx)(o.Ql,{value:"hieu_truong",children:"Hiệu trưởng"}),(0,i.jsx)(o.Ql,{value:"pho_hieu_truong",children:"Ph\xf3 hiệu trưởng"}),(0,i.jsx)(o.Ql,{value:"nhan_vien_cntt",children:"Nh\xe2n vi\xean CNTT"}),(0,i.jsx)(o.Ql,{value:"admin",children:"Quản trị tối cao"})]})]})]}),(null==S?void 0:S.role)==="homeroom_teacher"&&(0,i.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,i.jsx)(m._,{htmlFor:"assignedClasses",className:"text-right",children:"Lớp phụ tr\xe1ch"}),(0,i.jsx)(c.I,{id:"assignedClasses",value:Array.isArray(null==S?void 0:S.assignedClasses)?S.assignedClasses.join(", "):(null==S?void 0:S.assignedClasses)||"",onChange:e=>k({...S,assignedClasses:e.target.value.split(",").map(e=>e.trim()).filter(Boolean)}),className:"col-span-3",placeholder:"V\xed dụ: class_7_1, class_7_2"})]})]}),(0,i.jsxs)(h.cN,{children:[(0,i.jsx)(h.GG,{asChild:!0,children:(0,i.jsx)(r.z,{variant:"outline",children:"Hủy"})}),(0,i.jsx)(r.z,{onClick:D,children:"Lưu"})]})]})})]}):(0,i.jsxs)("div",{className:"p-8 text-center text-red-600 bg-red-50 rounded-lg",children:[(0,i.jsx)("h1",{className:"text-2xl font-bold",children:"Truy cập bị từ chối"}),(0,i.jsx)("p",{children:"Bạn kh\xf4ng c\xf3 quyền truy cập trang n\xe0y."})]})}},95731:function(e,s,l){"use strict";l.d(s,{Z:function(){return i}});let i=(0,l(2389).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])}},function(e){e.O(0,[6415,5117,2997,1661,6951,9445,6158,7554,792,5142,1293,1528,1744],function(){return e(e.s=84732)}),_N_E=e.O()}]);
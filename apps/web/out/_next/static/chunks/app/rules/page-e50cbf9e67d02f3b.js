(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[821],{3771:function(e,t,n){Promise.resolve().then(n.bind(n,6497))},6497:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return f}});var s=n(7573),a=n(7653),r=n(6228),l=n(9546),o=n(466),i=n(9324),c=n(9134),d=n(6529);let u={toFirestore(e){let t={...e};return t.updatedAt=r.EK.now(),t},fromFirestore(e){var t,n,s,a,r,l,o;let i=e.data();return{id:e.id,code:String(null!==(t=i.code)&&void 0!==t?t:""),category:String(null!==(n=i.category)&&void 0!==n?n:""),content:String(null!==(a=null!==(s=i.description)&&void 0!==s?s:i.content)&&void 0!==a?a:""),score:Number(null!==(l=null!==(r=i.points)&&void 0!==r?r:i.score)&&void 0!==l?l:0),order:"number"==typeof i.order?i.order:null,updatedAt:null!==(o=i.updatedAt)&&void 0!==o?o:null}}};function m(e){let{score:t}=e,n=t>0?"+".concat(t):String(t);return(0,s.jsx)("span",{className:t<0?"text-red-600 font-semibold":"text-green-600 font-semibold",children:n})}function f(){let e=null!==l.db&&void 0!==l.db?l.db:(0,r.ad)(),[t,n]=(0,a.useState)(null),[f,x]=(0,a.useState)(!1),[h,p]=(0,a.useState)([]),[g,y]=(0,a.useState)(!0),[b,N]=(0,a.useState)(!1),[j,v]=(0,a.useState)({category:"",content:"",score:0}),[w,k]=(0,a.useState)(!1);(0,a.useEffect)(()=>l.I.onAuthStateChanged(async e=>{if(n(e),e)try{let t=await e.getIdTokenResult();x("admin"===t.claims.role)}catch(e){console.error("Error getting user claims:",e),x(!1)}else x(!1)}),[]),(0,a.useEffect)(()=>{if(null===t){y(!1),p([]);return}y(!0);let n=(0,r.IO)((0,r.hJ)(e,"rules").withConverter(u),(0,r.Xo)("code","asc"));return(0,r.cf)(n,e=>{p(e.docs.map(e=>e.data())),y(!1)},e=>{console.error("Load rules error:",e),y(!1)})},[e,t]);let S=async()=>{if(!j.category||!j.content){alert("Vui l\xf2ng điền đầy đủ Danh mục v\xe0 Nội dung!");return}k(!0);try{let t="VP001";if(h.length>0){let e=h[h.length-1].code,n=e.match(/^([A-Z]+)(\d+)$/);if(n){let e=n[1],s=n[2],a=parseInt(s,10)+1;t=e+String(a).padStart(s.length,"0")}else console.warn("Last rule code format is unexpected. Using default.",e)}let n={code:t,category:j.category,content:j.content,score:Number(j.score)||0},s=(0,r.hJ)(e,"rules").withConverter(u);await (0,r.ET)(s,n),N(!1),v({category:"",content:"",score:0})}catch(e){console.error("Error adding document: ",e),alert("Đ\xe3 c\xf3 lỗi xảy ra khi lưu. Vui l\xf2ng thử lại.")}finally{k(!1)}},C=e=>{let{name:t,value:n}=e.target;v(e=>({...e,[t]:n}))},I=(0,a.useMemo)(()=>(0,s.jsx)("h1",{className:"text-3xl font-black leading-tight",children:(0,s.jsx)("span",{className:"bg-gradient-to-r from-[#ff7a18] to-[#af002d] bg-clip-text text-transparent",children:"Quản L\xfd Quy Định"})}),[]);return(0,s.jsxs)("div",{className:"mx-auto max-w-6xl px-4 py-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[I,(0,s.jsx)("p",{className:"mt-2 text-muted-foreground",children:"Th\xeam, sửa, xo\xe1 v\xe0 quản l\xfd c\xe1c quy định về điểm số của nh\xe0 trường."})]}),f&&(0,s.jsx)(o.z,{onClick:()=>N(!0),children:"Th\xeam Nội Quy"})]}),(0,s.jsxs)("div",{className:"mt-6 rounded-xl border bg-background shadow-sm",children:[(0,s.jsxs)("div",{className:"border-b px-4 py-3",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold",children:"Danh S\xe1ch Nội Quy"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Chi tiết c\xe1c nội quy đang được \xe1p dụng trong to\xe0n hệ thống."})]}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full table-fixed border-separate border-spacing-0",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"border-b bg-muted/40 text-left text-sm font-medium",children:[(0,s.jsx)("th",{className:"w-16 px-4 py-3",children:"STT"}),(0,s.jsx)("th",{className:"w-32 px-4 py-3",children:"M\xe3 số"}),(0,s.jsx)("th",{className:"w-40 px-4 py-3",children:"Danh mục"}),(0,s.jsx)("th",{className:"px-4 py-3",children:"Nội dung / Ghi ch\xfa"}),(0,s.jsx)("th",{className:"w-28 px-4 py-3",children:"Điểm số"}),(0,s.jsx)("th",{className:"w-36 px-4 py-3",children:"H\xe0nh động"})]})}),(0,s.jsxs)("tbody",{className:"text-sm",children:[g&&(0,s.jsx)("tr",{children:(0,s.jsx)("td",{className:"px-4 py-6 text-center",colSpan:6,children:"Đang tải dữ liệu…"})}),!g&&0===h.length&&(0,s.jsx)("tr",{children:(0,s.jsx)("td",{className:"px-4 py-6 text-center",colSpan:6,children:"Chưa c\xf3 nội quy n\xe0o."})}),!g&&h.map((e,t)=>(0,s.jsxs)("tr",{className:"border-t hover:bg-muted/30",children:[(0,s.jsx)("td",{className:"px-4 py-3",children:t+1}),(0,s.jsx)("td",{className:"px-4 py-3 font-medium",children:e.code}),(0,s.jsx)("td",{className:"px-4 py-3",children:e.category}),(0,s.jsx)("td",{className:"px-4 py-3",children:e.content}),(0,s.jsx)("td",{className:"px-4 py-3",children:(0,s.jsx)(m,{score:e.score})}),(0,s.jsx)("td",{className:"px-4 py-3",children:f?(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("button",{type:"button",className:"text-blue-600 hover:underline",children:"Sửa"}),(0,s.jsx)("button",{type:"button",className:"text-red-600 hover:underline",children:"Xo\xe1"})]}):(0,s.jsx)("span",{className:"text-muted-foreground",children:"Chỉ QTV"})})]},e.id))]})]})})]}),(0,s.jsx)(i.Vq,{open:b,onOpenChange:N,children:(0,s.jsxs)(i.cZ,{className:"sm:max-w-[425px] bg-white dark:bg-slate-950",children:[(0,s.jsx)(i.fK,{children:(0,s.jsx)(i.$N,{children:"Th\xeam Nội Quy Mới"})}),(0,s.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,s.jsx)(d._,{htmlFor:"category",className:"text-right",children:"Danh mục"}),(0,s.jsx)(c.I,{id:"category",name:"category",value:j.category,onChange:C,className:"col-span-3",placeholder:"VD: An to\xe0n"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,s.jsx)(d._,{htmlFor:"content",className:"text-right",children:"Nội dung"}),(0,s.jsx)(c.I,{id:"content",name:"content",value:j.content,onChange:C,className:"col-span-3",placeholder:"M\xf4 tả chi tiết nội quy"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,s.jsx)(d._,{htmlFor:"score",className:"text-right",children:"Điểm số"}),(0,s.jsx)(c.I,{id:"score",name:"score",type:"number",value:j.score,onChange:C,className:"col-span-3",placeholder:"VD: -15"})]})]}),(0,s.jsxs)(i.cN,{children:[(0,s.jsx)(i.GG,{asChild:!0,children:(0,s.jsx)(o.z,{type:"button",variant:"secondary",children:"Huỷ"})}),(0,s.jsx)(o.z,{type:"submit",onClick:S,disabled:w,children:w?"Đang lưu...":"Lưu"})]})]})})]})}},466:function(e,t,n){"use strict";n.d(t,{z:function(){return c}});var s=n(7573),a=n(7653),r=n(8828),l=n(9289),o=n(9147);let i=(0,l.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=a.forwardRef((e,t)=>{let{className:n,variant:a,size:l,asChild:c=!1,...d}=e,u=c?r.g7:"button";return(0,s.jsx)(u,{className:(0,o.cn)(i({variant:a,size:l,className:n})),ref:t,...d})});c.displayName="Button"},9324:function(e,t,n){"use strict";n.d(t,{$N:function(){return h},GG:function(){return d},Vq:function(){return i},cN:function(){return x},cZ:function(){return m},fK:function(){return f}});var s=n(7573),a=n(7653),r=n(7905),l=n(8862),o=n(9147);let i=r.fC;r.xz;let c=r.h_,d=r.x8,u=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,s.jsx)(r.aV,{ref:t,className:(0,o.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",n),...a})});u.displayName=r.aV.displayName;let m=a.forwardRef((e,t)=>{let{className:n,children:a,...i}=e;return(0,s.jsxs)(c,{children:[(0,s.jsx)(u,{}),(0,s.jsxs)(r.VY,{ref:t,className:(0,o.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",n),...i,children:[a,(0,s.jsxs)(r.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,s.jsx)(l.Z,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});m.displayName=r.VY.displayName;let f=e=>{let{className:t,...n}=e;return(0,s.jsx)("div",{className:(0,o.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...n})};f.displayName="DialogHeader";let x=e=>{let{className:t,...n}=e;return(0,s.jsx)("div",{className:(0,o.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...n})};x.displayName="DialogFooter";let h=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,s.jsx)(r.Dx,{ref:t,className:(0,o.cn)("text-lg font-semibold leading-none tracking-tight",n),...a})});h.displayName=r.Dx.displayName,a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,s.jsx)(r.dk,{ref:t,className:(0,o.cn)("text-sm text-muted-foreground",n),...a})}).displayName=r.dk.displayName},9134:function(e,t,n){"use strict";n.d(t,{I:function(){return l}});var s=n(7573),a=n(7653),r=n(9147);let l=a.forwardRef((e,t)=>{let{className:n,type:a,...l}=e;return(0,s.jsx)("input",{type:a,className:(0,r.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",n),ref:t,...l})});l.displayName="Input"},6529:function(e,t,n){"use strict";n.d(t,{_:function(){return c}});var s=n(7573),a=n(7653),r=n(1001),l=n(9289),o=n(9147);let i=(0,l.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,s.jsx)(r.f,{ref:t,className:(0,o.cn)(i(),n),...a})});c.displayName=r.f.displayName},9546:function(e,t,n){"use strict";n.d(t,{I:function(){return i},db:function(){return o},l:function(){return l}});var s=n(8531),a=n(6228),r=n(1523);let l=(0,s.C6)().length?(0,s.Mq)():(0,s.ZF)({apiKey:"AIzaSyAqGxdFqDGXOiiKP5cKFvPkNkmTdY4aByw",authDomain:"app-quan-ly-hs.firebaseapp.com",projectId:"app-quan-ly-hs",storageBucket:"app-quan-ly-hs.firebasestorage.app",messagingSenderId:"771200825229",appId:"1:771200825229:web:bdffe0944b21edff21afc4"}),o=(0,a.ad)(l),i=(0,r.v0)(l)},9147:function(e,t,n){"use strict";n.d(t,{cn:function(){return r}});var s=n(607),a=n(5579);function r(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,a.m6)((0,s.W)(t))}}},function(e){e.O(0,[415,5,460,549,143,419,293,528,744],function(){return e(e.s=3771)}),_N_E=e.O()}]);
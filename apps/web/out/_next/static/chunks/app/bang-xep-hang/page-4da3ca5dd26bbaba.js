(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[283],{7284:function(e,t,a){Promise.resolve().then(a.bind(a,3455))},3455:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return _}});var r=a(7573),n=a(7653),s=a(8609),l=a(466),o=a(6228),i=a(1245);let d=(0,o.ad)(i.l2),c=new Date(new Date().getFullYear(),8,8),u=e=>{let t=new Date(e);return t.setHours(0,0,0,0),t},m=()=>{let e=[];for(let t=1;t<=35;t++){let a=new Date(u(c).getTime()+(t-1)*6048e5),r=new Date(a.getTime()+5184e5),n=e=>e<10?"0".concat(e):"".concat(e);e.push("Tuần ".concat(t," (").concat(n(a.getDate()),"/").concat(n(a.getMonth()+1)," - ").concat(n(r.getDate()),"/").concat(n(r.getMonth()+1),")"))}return e},h=e=>{if(!e)return"";let t=e.match(/class_(\d+)_/);return t?t[1]:""},f=e=>e&&e.startsWith("class_")?e.substring(6).replace(/_/g,"/"):e,b=e=>"class_".concat(e.replace("/","_")),x=[{name:"Khối 6",classes:["6/1","6/2","6/3","6/4","6/5","6/6","6/7","6/8","6/9","6/10"]},{name:"Khối 7",classes:["7/1","7/2","7/3","7/4","7/5","7/6","7/7","7/8"]},{name:"Khối 8",classes:["8/1","8/2","8/3","8/4","8/5","8/6","8/7"]},{name:"Khối 9",classes:["9/1","9/2","9/3","9/4","9/5","9/6","9/7","9/8"]}],p=[{key:"hoc_tap",label:"HỌC TẬP",editable:!0},{key:"ky_luat",label:"KỶ LUẬT",editable:!0},{key:"ve_sinh",label:"VỆ SINH",editable:!0},{key:"diem_cong",label:"ĐIỂM CỘNG",editable:!1},{key:"diem_tru",label:"ĐIỂM TRỪ",editable:!1},{key:"tong_diem",label:"TỔNG ĐIỂM",editable:!1},{key:"hang",label:"HẠNG",editable:!1},{key:"nhan_xet",label:"NHẬN X\xc9T",editable:!0}],g=m(),y=(()=>{let e=Math.max(1,Math.min(35,Math.floor(Math.floor((u(new Date).getTime()-u(c).getTime())/864e5)/7)+1));return m().find(t=>t.startsWith("Tuần ".concat(e," ")))||m()[0]})();function v(e){let{isOpen:t,onClose:a,onSave:s,classData:o}=e;if(!t||!o)return null;let[i,d]=(0,n.useState)({hoc_tap:o.scores.hoc_tap||0,ky_luat:o.scores.ky_luat||0,ve_sinh:o.scores.ve_sinh||0,nhan_xet:o.scores.nhan_xet||""}),c=e=>{let{name:t,value:a}=e.target,r=["hoc_tap","ky_luat","ve_sinh"].includes(t);d(e=>({...e,[t]:r?""===a?"":Number(a):a}))};return(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-xl p-6 w-full max-w-md",children:[(0,r.jsxs)("h3",{className:"text-xl font-bold mb-4",children:["Cập nhật điểm cho lớp ",o.className]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Học tập"}),(0,r.jsx)("input",{type:"number",name:"hoc_tap",value:i.hoc_tap,onChange:c,className:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Kỷ luật"}),(0,r.jsx)("input",{type:"number",name:"ky_luat",value:i.ky_luat,onChange:c,className:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Vệ sinh"}),(0,r.jsx)("input",{type:"number",name:"ve_sinh",value:i.ve_sinh,onChange:c,className:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Nhận x\xe9t"}),(0,r.jsx)("input",{type:"text",name:"nhan_xet",value:i.nhan_xet,onChange:c,className:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"})]})]}),(0,r.jsxs)("div",{className:"mt-6 flex justify-end space-x-4",children:[(0,r.jsx)(l.z,{variant:"outline",onClick:a,children:"Hủy"}),(0,r.jsx)(l.z,{onClick:()=>{s({hoc_tap:""===i.hoc_tap?0:i.hoc_tap,ky_luat:""===i.ky_luat?0:i.ky_luat,ve_sinh:""===i.ve_sinh?0:i.ve_sinh,nhan_xet:i.nhan_xet}),a()},children:"Lưu thay đổi"})]})]})})}function _(){let[e,t]=(0,n.useState)(y),[a,i]=(0,n.useState)({}),[c,u]=(0,n.useState)({}),[m,_]=(0,n.useState)(!1),[w,N]=(0,n.useState)(null);(0,n.useEffect)(()=>{var t;let a=null===(t=e.match(/\d+/))||void 0===t?void 0:t[0];if(!a)return;let r=(0,o.IO)((0,o.hJ)(d,"weeklyScores"),(0,o.ar)("week","==",Number(a))),n=(0,o.cf)(r,e=>{let t={};x.forEach(e=>{t[e.name]={}}),e.forEach(e=>{let a=e.data();a.gradeName&&a.className&&a.scores&&(t[a.gradeName]||(t[a.gradeName]={}),t[a.gradeName][a.className]=a.scores)}),i(t)});return()=>n()},[e]),(0,n.useEffect)(()=>{var t;let a=null===(t=e.match(/\d+/))||void 0===t?void 0:t[0];if(!a)return;let r=parseInt(a,10),n=(0,o.IO)((0,o.hJ)(d,"records"),(0,o.ar)("week","==",r)),s=(0,o.cf)(n,e=>{let t={};x.forEach(e=>{t[e.name]={},e.classes.forEach(a=>{t[e.name][a]={diem_cong:0,diem_tru:0}})}),e.forEach(e=>{let a=e.data();if(!a.classRef||!a.type)return;let r="Khối ".concat(h(a.classRef)),n=f(a.classRef);if(t[r]&&t[r][n]){let e=Number(a.pointsApplied||0);"merit"===a.type?t[r][n].diem_cong+=e:"demerit"===a.type&&(t[r][n].diem_tru+=Math.abs(e))}}),u(t)});return()=>s()},[e]);let j=(0,n.useMemo)(()=>{let e={};return x.forEach(t=>{let r="Khối 9"===t.name?330:340,n=[];t.classes.forEach(e=>{var s,l,o,i,d;let u=(null===(s=a[t.name])||void 0===s?void 0:s[e])||{},m=(null===(l=c[t.name])||void 0===l?void 0:l[e])||{diem_cong:0,diem_tru:0},h=null!==(o=u.hoc_tap)&&void 0!==o?o:r,f=null!==(i=u.ky_luat)&&void 0!==i?i:r,b=null!==(d=u.ve_sinh)&&void 0!==d?d:r,x=h+f+b+m.diem_cong-m.diem_tru;n.push({className:e,hoc_tap:h,ky_luat:f,ve_sinh:b,nhan_xet:u.nhan_xet,...m,tong_diem:x})}),n.sort((e,t)=>t.tong_diem-e.tong_diem),e[t.name]={};let s=0,l=1/0;n.forEach((a,r)=>{a.tong_diem<l&&(s=r+1),e[t.name][a.className]={...a,hang:s},l=a.tong_diem})}),e},[a,c]),k=(e,t)=>{var a;let r=(null===(a=j[e])||void 0===a?void 0:a[t])||{};N({gradeName:e,className:t,scores:r}),_(!0)},C=async t=>{var a;if(!w)return;let{gradeName:r,className:n}=w,s=null===(a=e.match(/\d+/))||void 0===a?void 0:a[0];if(!s){alert("Tuần kh\xf4ng hợp lệ.");return}let l=b(n),i="week_".concat(s,"_").concat(l),c=(0,o.JU)(d,"weeklyScores",i),u={week:Number(s),classId:l,className:n,gradeName:r,scores:t};try{await (0,o.pl)(c,u,{merge:!0}),_(!1)}catch(e){console.error("Error writing document: ",e),alert("Đ\xe3 c\xf3 lỗi xảy ra khi lưu điểm.")}},T={"Khối 6":{text:"text-red-700",border:"border-red-300",bg:"bg-red-50"},"Khối 7":{text:"text-yellow-700",border:"border-yellow-400",bg:"bg-yellow-50"},"Khối 8":{text:"text-blue-700",border:"border-blue-300",bg:"bg-blue-50"},"Khối 9":{text:"text-green-700",border:"border-green-300",bg:"bg-green-50"}};return(0,r.jsxs)("div",{className:"container mx-auto p-4 md:p-8 bg-gray-50 min-h-screen",children:[(0,r.jsx)(v,{isOpen:m,onClose:()=>_(!1),onSave:C,classData:w}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-center mb-6",children:[(0,r.jsx)("h1",{className:"text-2xl md:text-3xl font-bold text-gray-800 mb-4 sm:mb-0",children:"Bảng Xếp Hạng Thi Đua"}),(0,r.jsxs)(s.Ph,{onValueChange:t,value:e,children:[(0,r.jsx)(s.i4,{className:"w-full sm:w-[320px] bg-white shadow-sm border-gray-300",children:(0,r.jsx)(s.ki,{placeholder:"Chọn tuần"})}),(0,r.jsx)(s.Bw,{className:"max-h-96 bg-white",children:g.map(e=>(0,r.jsx)(s.Ql,{value:e,children:e},e))})]})]}),(0,r.jsx)("div",{className:"flex flex-col gap-12",children:x.map(e=>{let t=T[e.name]||T["Khối 9"];return(0,r.jsxs)("div",{className:"bg-white p-4 sm:p-6 rounded-xl shadow-lg border border-gray-200 transition-all duration-300 hover:shadow-2xl hover:-translate-y-2",children:[(0,r.jsxs)("h2",{className:"text-xl sm:text-2xl font-bold text-center ".concat(t.text," mb-6"),children:["SƠ KẾT H\xc0NG TUẦN - ",e.name.toUpperCase()]}),(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("div",{className:"grid border-l border-t ".concat(t.border),style:{gridTemplateColumns:"minmax(120px, 1.5fr) repeat(".concat(e.classes.length,", minmax(90px, 1fr))")},children:[(0,r.jsx)("div",{className:"font-bold text-gray-700 p-3 border-r border-b ".concat(t.border," ").concat(t.bg," flex items-center justify-start"),children:"NỘI DUNG"}),e.classes.map(a=>(0,r.jsxs)("div",{className:"font-bold text-gray-800 p-3 border-r border-b ".concat(t.border," ").concat(t.bg," flex items-center justify-center relative group"),children:[a,(0,r.jsx)(l.z,{variant:"ghost",size:"sm",className:"ml-1 h-6 w-6 p-0 absolute right-1 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>k(e.name,a),children:"✏️"})]},a)),p.map(a=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"font-semibold p-3 border-r border-b ".concat(t.border," flex items-center ").concat("hang"===a.key?"bg-yellow-100 text-yellow-900":"bg-white"),children:a.label},a.key),e.classes.map(n=>{var s,l;let o=null===(s=j[e.name])||void 0===s?void 0:s[n],i=null!==(l=null==o?void 0:o[a.key])&&void 0!==l?l:"nhan_xet"===a.key?"":0,d=i,c="p-3 text-center border-r border-b ".concat(t.border," flex items-center justify-center font-medium");return"hang"===a.key&&(c+=" bg-yellow-200 font-bold text-yellow-900"),"diem_cong"===a.key&&i>0&&(d="+".concat(i),c+=" text-green-600 font-bold"),"diem_tru"===a.key&&i>0&&(d="-".concat(i),c+=" text-red-600 font-bold"),"tong_diem"===a.key&&(c+=" font-bold text-blue-800"),a.editable&&(c+=" cursor-pointer hover:bg-gray-100 transition-colors"),(0,r.jsx)("div",{className:c,onClick:()=>a.editable&&k(e.name,n),children:d},n)})]}))]})})]},e.name)})})]})}},466:function(e,t,a){"use strict";a.d(t,{z:function(){return d}});var r=a(7573),n=a(7653),s=a(8828),l=a(9289),o=a(9147);let i=(0,l.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=n.forwardRef((e,t)=>{let{className:a,variant:n,size:l,asChild:d=!1,...c}=e,u=d?s.g7:"button";return(0,r.jsx)(u,{className:(0,o.cn)(i({variant:n,size:l,className:a})),ref:t,...c})});d.displayName="Button"},8609:function(e,t,a){"use strict";a.d(t,{Bw:function(){return b},Ph:function(){return c},Ql:function(){return x},i4:function(){return m},ki:function(){return u}});var r=a(7573),n=a(7653),s=a(3912),l=a(9854),o=a(8202),i=a(8),d=a(9147);let c=s.fC;s.ZA;let u=s.B4,m=n.forwardRef((e,t)=>{let{className:a,children:n,...o}=e;return(0,r.jsxs)(s.xz,{ref:t,className:(0,d.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",a),...o,children:[n,(0,r.jsx)(s.JO,{asChild:!0,children:(0,r.jsx)(l.Z,{className:"h-4 w-4 opacity-50"})})]})});m.displayName=s.xz.displayName;let h=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)(s.u_,{ref:t,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",a),...n,children:(0,r.jsx)(o.Z,{className:"h-4 w-4"})})});h.displayName=s.u_.displayName;let f=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)(s.$G,{ref:t,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",a),...n,children:(0,r.jsx)(l.Z,{className:"h-4 w-4"})})});f.displayName=s.$G.displayName;let b=n.forwardRef((e,t)=>{let{className:a,children:n,position:l="popper",...o}=e;return(0,r.jsx)(s.h_,{children:(0,r.jsxs)(s.VY,{ref:t,className:(0,d.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===l&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:l,...o,children:[(0,r.jsx)(h,{}),(0,r.jsx)(s.l_,{className:(0,d.cn)("p-1","popper"===l&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:n}),(0,r.jsx)(f,{})]})})});b.displayName=s.VY.displayName,n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)(s.__,{ref:t,className:(0,d.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",a),...n})}).displayName=s.__.displayName;let x=n.forwardRef((e,t)=>{let{className:a,children:n,...l}=e;return(0,r.jsxs)(s.ck,{ref:t,className:(0,d.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...l,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(s.wU,{children:(0,r.jsx)(i.Z,{className:"h-4 w-4"})})}),(0,r.jsx)(s.eT,{children:n})]})});x.displayName=s.ck.displayName,n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)(s.Z0,{ref:t,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",a),...n})}).displayName=s.Z0.displayName},1245:function(e,t,a){"use strict";a.d(t,{l2:function(){return d},I8:function(){return c},db:function(){return u}});var r=a(8531),n=a(1523),s=a(6228),l=a(2615),o=a(1913),i=a(2149);let d=(0,r.C6)().length?(0,r.Mq)():(0,r.ZF)({apiKey:"AIzaSyAqGxdFqDGXOiiKP5cKFvPkNkmTdY4aByw",authDomain:"app-quan-ly-hs.firebaseapp.com",projectId:"app-quan-ly-hs",storageBucket:"app-quan-ly-hs.appspot.com",messagingSenderId:"771200825229",appId:"1:771200825229:web:cbc5498073eff6be21afc4"});(0,i.yu)(d,{provider:new i.z9("6Lf-0_gpAAAAAB6_ZgV7e_FvX8xw_9x3X_yYjW4C"),isTokenAutoRefreshEnabled:!0});let c=(0,n.v0)(d),u=(0,s.ad)(d);(0,l.cF)(d),(0,o.$C)(d)},9147:function(e,t,a){"use strict";a.d(t,{cn:function(){return s}});var r=a(607),n=a(5579);function s(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,n.m6)((0,r.W)(t))}}},function(e){e.O(0,[415,5,460,549,143,703,318,192,293,528,744],function(){return e(e.s=7284)}),_N_E=e.O()}]);